"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),CanvasSequence=function(){function e(t,n,s,i,a,o,r){var u=!(arguments.length<=7||void 0===arguments[7])&&arguments[7],c=arguments.length<=8||void 0===arguments[8]?24:arguments[8];return _classCallCheck(this,e),"object"==typeof t?this.ctor(t):void this.ctor({canvas:t,sequencePath:n,sequenceStart:s,sequenceEnd:i,fileType:a,loadCallback:o,onDraw:r,autoPlay:u,fps:c})}return _createClass(e,[{key:"ctor",value:function(e){var t=e.canvas,n=e.sequencePath,s=e.sequenceStart,i=e.sequenceEnd,a=e.fileType,o=e.loadCallback,r=e.onDraw,u=e.autoPlay,c=void 0!==u&&u,h=e.fps,l=void 0===h?24:h;this.sequence=[],this.canvas=document.getElementById(t),null!==this.canvas?this.context=this.canvas.getContext("2d"):console.log("Please ensure the lib is loaded when DOM is loaded."),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.sequencePath=n,this.sequenceStart=s,this.sequenceEnd=i,this.sequenceLength=this.sequenceEnd-this.sequenceStart,this.fileType=a||".png",this.scrollHeight=document.body.scrollHeight,this.scrollOffset=document.body.scrollTop,this.clientHeight=window.innerHeight,this.loadCallback=o||function(){},this.onDraw="function"==typeof r?r:null,this.autoPlay=c,this.isPaused=!1,this.fps=l,this.loadSequence()}},{key:"pause",value:function(){this.isPaused=!0}},{key:"play",value:function(){if(this.isPaused){var e=+new Date;this.startTime=e-this.currentFrame/this.fps*1e3,this.isPaused=!1}}},{key:"addLeadingZeros",value:function(e){for(var t=this.sequenceEnd.toString().length,n=(e>0?e:-e)+"",s="",i=t-n.length;i>0;i--)s+="0";return s+=n,e>=0?s:"-"+s}},{key:"loadSequence",value:function(){for(var e=this,t=[],n=this.sequenceStart;n<=this.sequenceEnd;n++){var s=this.addLeadingZeros(n),i=this.sequencePath+s+this.fileType,a=new Image;a.src=i;var o=new Promise(function(e,t){a.onload=e,a.onerror=t});t.push(o),this.sequence.push(a)}Promise.all(t).then(function(){e.renderFrame(),e.loadCallback()})["catch"](function(e){console.log(e)})}},{key:"getScrollFrameNumber",value:function(){var e=this.scrollOffset/(this.scrollHeight-this.clientHeight)*100,t=Math.round(e*this.sequenceLength/100);return t}},{key:"getAutoPlayFrameNumber",value:function(){return Math.round(this.fps*this.playOffset)}},{key:"getNextFrameNumber",value:function(){return this.autoPlay?this.getAutoPlayFrameNumber():this.getScrollFrameNumber()}},{key:"syncScrollPosition",value:function(){this.scrollOffset=document.body.scrollTop}},{key:"syncAutoPlayPosition",value:function(){var e=+new Date;this.startTime||(this.startTime=e,this.isPaused=!1),this.isPaused||(this.playOffset=(e-this.startTime)/1e3%(this.sequenceLength/this.fps))}},{key:"syncPlayPosition",value:function(){return this.autoPlay?this.syncAutoPlayPosition():this.syncScrollPosition()}},{key:"drawImage",value:function(e){e>=0&&e<this.sequence.length&&(this.sequence[e].complete?this.context.drawImage(this.sequence[e],0,0,this.canvas.width,this.canvas.height):console.log("The current frame has not been loaded. Please ensure all images are loaded before updating the canvas."))}},{key:"renderFrame",value:function(){var e=this;this.syncPlayPosition(),requestAnimationFrame(function(){e.renderFrame()}),this.previousFrame=this.currentFrame,this.currentFrame=this.getNextFrameNumber(),(this.currentFrame!=this.previousFrame||this.firstLoad)&&(this.drawImage(this.currentFrame),this.onDraw&&this.onDraw.call(null,this.previousFrame,this.currentFrame)),this.firstLoad=!1}}]),e}();window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}()),"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return CanvasSequence}):"undefined"!=typeof module&&module.exports?module.exports=CanvasSequence:window.CanvasSequence=CanvasSequence;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhbnZhc1NlcXVlbmNlLmpzIl0sIm5hbWVzIjpbIl9jbGFzc0NhbGxDaGVjayIsImluc3RhbmNlIiwiQ29uc3RydWN0b3IiLCJUeXBlRXJyb3IiLCJfY3JlYXRlQ2xhc3MiLCJkZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJpIiwibGVuZ3RoIiwiZGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5Iiwia2V5IiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwicHJvdG90eXBlIiwiQ2FudmFzU2VxdWVuY2UiLCJjYW52YXNPck9wdHMiLCJzZXF1ZW5jZVBhdGgiLCJzZXF1ZW5jZVN0YXJ0Iiwic2VxdWVuY2VFbmQiLCJmaWxlVHlwZSIsImxvYWRDYWxsYmFjayIsIm9uRHJhdyIsImF1dG9QbGF5IiwiYXJndW1lbnRzIiwidW5kZWZpbmVkIiwiZnBzIiwidGhpcyIsImN0b3IiLCJjYW52YXMiLCJ2YWx1ZSIsIl9yZWYiLCJfcmVmJGF1dG9QbGF5IiwiX3JlZiRmcHMiLCJzZXF1ZW5jZSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJjb250ZXh0IiwiZ2V0Q29udGV4dCIsImNvbnNvbGUiLCJsb2ciLCJ3aWR0aCIsIndpbmRvdyIsImlubmVyV2lkdGgiLCJoZWlnaHQiLCJpbm5lckhlaWdodCIsInNlcXVlbmNlTGVuZ3RoIiwic2Nyb2xsSGVpZ2h0IiwiYm9keSIsInNjcm9sbE9mZnNldCIsInNjcm9sbFRvcCIsImNsaWVudEhlaWdodCIsImlzUGF1c2VkIiwibG9hZFNlcXVlbmNlIiwibm93IiwiRGF0ZSIsInN0YXJ0VGltZSIsImN1cnJlbnRGcmFtZSIsIm4iLCJ0b1N0cmluZyIsInN0ciIsInplcm9zIiwiX3RoaXMiLCJwcm9taXNlcyIsImZyYW1lTnVtYmVyIiwiYWRkTGVhZGluZ1plcm9zIiwiZmlsZW5hbWUiLCJpbWciLCJJbWFnZSIsInNyYyIsInByb21pc2UiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm9ubG9hZCIsIm9uZXJyb3IiLCJwdXNoIiwiYWxsIiwidGhlbiIsInJlbmRlckZyYW1lIiwiZSIsInNjcm9sbFBlcmNlbnRhZ2UiLCJjdXJyZW50RnJhbWVOdW1iZXIiLCJNYXRoIiwicm91bmQiLCJwbGF5T2Zmc2V0IiwiZ2V0QXV0b1BsYXlGcmFtZU51bWJlciIsImdldFNjcm9sbEZyYW1lTnVtYmVyIiwic3luY0F1dG9QbGF5UG9zaXRpb24iLCJzeW5jU2Nyb2xsUG9zaXRpb24iLCJmcmFtZSIsImNvbXBsZXRlIiwiZHJhd0ltYWdlIiwiX3RoaXMyIiwic3luY1BsYXlQb3NpdGlvbiIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsInByZXZpb3VzRnJhbWUiLCJnZXROZXh0RnJhbWVOdW1iZXIiLCJmaXJzdExvYWQiLCJjYWxsIiwid2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwibW96UmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwib1JlcXVlc3RBbmltYXRpb25GcmFtZSIsIm1zUmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwiY2FsbGJhY2siLCJlbGVtZW50Iiwic2V0VGltZW91dCIsImRlZmluZSIsImFtZCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBLFlBSUEsU0FBU0EsaUJBQWdCQyxFQUFVQyxHQUFlLEtBQU1ELFlBQW9CQyxJQUFnQixLQUFNLElBQUlDLFdBQVUscUNBRmhILEdBQUlDLGNBQWUsV0FBZSxRQUFTQyxHQUFpQkMsRUFBUUMsR0FBUyxJQUFLLEdBQUlDLEdBQUksRUFBR0EsRUFBSUQsRUFBTUUsT0FBUUQsSUFBSyxDQUFFLEdBQUlFLEdBQWFILEVBQU1DLEVBQUlFLEdBQVdDLFdBQWFELEVBQVdDLGFBQWMsRUFBT0QsRUFBV0UsY0FBZSxFQUFVLFNBQVdGLEtBQVlBLEVBQVdHLFVBQVcsR0FBTUMsT0FBT0MsZUFBZVQsRUFBUUksRUFBV00sSUFBS04sSUFBaUIsTUFBTyxVQUFVUixF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Y2VzQ29udGVudCI6WyJjbGFzcyBDYW52YXNTZXF1ZW5jZSB7XG5cbiAgICAvKipcbiAgICAgKiBAc2VlIGN0b3JcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihjYW52YXNPck9wdHMsIHNlcXVlbmNlUGF0aCwgc2VxdWVuY2VTdGFydCwgc2VxdWVuY2VFbmQsIGZpbGVUeXBlLCBsb2FkQ2FsbGJhY2ssIG9uRHJhdywgYXV0b1BsYXkgPSBmYWxzZSwgZnBzID0gMjQpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBjYW52YXNPck9wdHMgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAvLyBmaXJzdCBwYXJhbSBpcyBhbiBvYmplY3Qgb2Ygb3B0aW9uc1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3RvcihjYW52YXNPck9wdHMpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jdG9yKHtcbiAgICAgICAgICAgIGNhbnZhczogY2FudmFzT3JPcHRzLFxuICAgICAgICAgICAgc2VxdWVuY2VQYXRoLFxuICAgICAgICAgICAgc2VxdWVuY2VTdGFydCxcbiAgICAgICAgICAgIHNlcXVlbmNlRW5kLFxuICAgICAgICAgICAgZmlsZVR5cGUsXG4gICAgICAgICAgICBsb2FkQ2FsbGJhY2ssXG4gICAgICAgICAgICBvbkRyYXcsXG4gICAgICAgICAgICBhdXRvUGxheSxcbiAgICAgICAgICAgIGZwc1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQHBhcmFtIG9wdHMuY2FudmFzSWQge1N0cmluZ30gLSBpZCBvZiB0aGUgY2FudmFzIHRhZyB5b3Ugd2FudCB0byB1c2VcbiAgICAgKiBAcGFyYW0gb3B0cy5zZXF1ZW5jZVBhdGgge1N0cmluZ30gLSB0aGUgcGF0aCB0byB5b3VyIGltYWdlIHNlcXVlbmNlIChleC4gJy4vaW1nL3NlcXVlbmNlLycpLiBJZiB5b3VyIGltYWdlcyBuYW1lcyBhcmUgcHJlZml4ZWQgKGV4LiBpbWdfMDAwLmpwZykgeW91IG11c3QgaW5jbHVkZSB0aGUgcHJlZml4IGluIHRoZSBwYXRoLlxuICAgICAqIEBwYXJhbSBvcHRzLnNlcXVlbmNlU3RhcnQge0ludH0gLSB0aGUgbnVtYmVyIG9mIHRoZSBmaXJzdCBmcmFtZSAoZXguIGlmIHlvdXIgZmlyc3QgZnJhbWUgaXMgaW1nXzAwMDU2LmpwZyB0aGVuIHNlcXVlbmNlU3RhcnQgPSA1NilcbiAgICAgKiBAcGFyYW0gb3B0cy5zZXF1ZW5jZUVuZCB7SW50fSAtIHRoZSBudW1iZXIgb2YgdGhlIGxhc3QgZnJhbWVcbiAgICAgKiBAcGFyYW0gb3B0cy5maWxlVHlwZSB7U3RyaW5nfSAtIHRoZSBmaWxlIGV4dGVuc2lvbiB5b3Ugd2FudCB0byB1c2UgKGV4LiAnanBnJylcbiAgICAgKiBAcGFyYW0gb3B0cy5sb2FkQ2FsbGJhY2sge2Z1bmN0aW9ufSAtIGEgY2FsbGJhY2sgdG8gYmUgbm90aWZpZWQgd2hlbiBhbGwgaW1hZ2VzIGFyZSBsb2FkZWQgYW5kIHJlYWR5IHRvIHVzZVxuICAgICAqIEBwYXJhbSBvcHRzLm9uRHJhdyB7ZnVuY3Rpb24ocHJldmlvdXNGcmFtZTpJbnQsIGN1cnJlbnRGcmFtZTpJbnQpYH0gLSBhIGNhbGxiYWNrIHRvIGJlIG5vdGlmaWVkIHdoZW4gdGhlIGRyYXduIGZyYW1lIGNoYW5nZXNcbiAgICAgKiBAcGFyYW0gb3B0cy5hdXRvUGxheSB7Qm9vbGVhbn0gLSBEZWZhdWx0cyB0byBgZmFsc2VgLiBhIGZsYWcgdG8gbWFrZSB0aGUgc2VxdWVuY2UgcGxheSB3aXRob3V0IGJpbmRpbmcgdG8gc2Nyb2xsIChsaWtlIGEgcmVndWxhciB2aWRlbylcbiAgICAgKiBAcGFyYW0gb3B0cy5mcHMge051bWJlcn0gLSBEZWZhdWx0cyB0byBgMjRgLiBGcmFtZXMgcGVyIHNlY29uZCB0byB1c2UgZm9yIHZpZGVvLWxpa2UgcGxheWJhY2tcbiAgICAgKi9cbiAgICBjdG9yKHsgY2FudmFzLCBzZXF1ZW5jZVBhdGgsIHNlcXVlbmNlU3RhcnQsIHNlcXVlbmNlRW5kLCBmaWxlVHlwZSwgbG9hZENhbGxiYWNrLCBvbkRyYXcsIGF1dG9QbGF5ID0gZmFsc2UsIGZwcyA9IDI0IH0pIHtcbiAgICAgICAgdGhpcy5zZXF1ZW5jZSA9IFtdO1xuXG4gICAgICAgIHRoaXMuY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY2FudmFzKTtcblxuICAgICAgICBpZih0aGlzLmNhbnZhcyAhPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5jb250ZXh0ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiUGxlYXNlIGVuc3VyZSB0aGUgbGliIGlzIGxvYWRlZCB3aGVuIERPTSBpcyBsb2FkZWQuXCIpXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmNhbnZhcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgICAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG5cbiAgICAgICAgdGhpcy5zZXF1ZW5jZVBhdGggPSBzZXF1ZW5jZVBhdGg7XG4gICAgICAgIHRoaXMuc2VxdWVuY2VTdGFydCA9IHNlcXVlbmNlU3RhcnQ7XG4gICAgICAgIHRoaXMuc2VxdWVuY2VFbmQgPSBzZXF1ZW5jZUVuZDtcbiAgICAgICAgdGhpcy5zZXF1ZW5jZUxlbmd0aCA9IHRoaXMuc2VxdWVuY2VFbmQgLSB0aGlzLnNlcXVlbmNlU3RhcnQ7XG5cbiAgICAgICAgdGhpcy5maWxlVHlwZSA9IGZpbGVUeXBlIHx8ICcucG5nJztcblxuICAgICAgICB0aGlzLnNjcm9sbEhlaWdodCA9IGRvY3VtZW50LmJvZHkuc2Nyb2xsSGVpZ2h0O1xuICAgICAgICB0aGlzLnNjcm9sbE9mZnNldCA9IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wO1xuICAgICAgICB0aGlzLmNsaWVudEhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcblxuICAgICAgICB0aGlzLmxvYWRDYWxsYmFjayA9IGxvYWRDYWxsYmFjayB8fCBmdW5jdGlvbigpIHt9O1xuICAgICAgICB0aGlzLm9uRHJhdyA9IHR5cGVvZiBvbkRyYXcgPT09ICdmdW5jdGlvbicgPyBvbkRyYXcgOiBudWxsO1xuICAgICAgICB0aGlzLmF1dG9QbGF5ID0gYXV0b1BsYXk7XG4gICAgICAgIHRoaXMuaXNQYXVzZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5mcHMgPSBmcHM7XG5cbiAgICAgICAgdGhpcy5sb2FkU2VxdWVuY2UoKTtcbiAgICB9XG5cbiAgICBwYXVzZSgpIHtcbiAgICAgICAgdGhpcy5pc1BhdXNlZCA9IHRydWU7XG4gICAgfVxuXG4gICAgcGxheSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzUGF1c2VkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvLyByZXNldCBzdGFydFRpbWUgc28gdGhhdCBpdCBpcyByZWxhdGl2ZSB0byB0aGUgY3VycmVudCByZXBsYXkgdGltZVxuICAgICAgICBjb25zdCBub3cgPSArbmV3IERhdGUoKTtcbiAgICAgICAgdGhpcy5zdGFydFRpbWUgPSBub3cgLSAodGhpcy5jdXJyZW50RnJhbWUgLyB0aGlzLmZwcyAqIDEwMDApXG4gICAgICAgIHRoaXMuaXNQYXVzZWQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBhZGRMZWFkaW5nWmVyb3Mobikge1xuICAgICAgICB2YXIgbGVuZ3RoID0gdGhpcy5zZXF1ZW5jZUVuZC50b1N0cmluZygpLmxlbmd0aDtcbiAgICAgICAgdmFyIHN0ciA9IChuID4gMCA/IG4gOiAtbikgKyBcIlwiO1xuICAgICAgICB2YXIgemVyb3MgPSBcIlwiO1xuICAgICAgICBmb3IgKHZhciBpID0gbGVuZ3RoIC0gc3RyLmxlbmd0aDsgaSA+IDA7IGktLSlcbiAgICAgICAgICAgIHplcm9zICs9IFwiMFwiO1xuICAgICAgICB6ZXJvcyArPSBzdHI7XG4gICAgICAgIHJldHVybiBuID49IDAgPyB6ZXJvcyA6IFwiLVwiICsgemVyb3M7XG4gICAgfVxuXG4gICAgbG9hZFNlcXVlbmNlKCkge1xuXG4gICAgICAgIHZhciBwcm9taXNlcyA9IFtdO1xuXG4gICAgICAgIGZvcih2YXIgaSA9IHRoaXMuc2VxdWVuY2VTdGFydDsgaSA8PSB0aGlzLnNlcXVlbmNlRW5kOyBpKyspIHtcblxuICAgICAgICAgICAgdmFyIGZyYW1lTnVtYmVyID0gdGhpcy5hZGRMZWFkaW5nWmVyb3MoaSk7XG4gICAgICAgICAgICB2YXIgZmlsZW5hbWUgPSB0aGlzLnNlcXVlbmNlUGF0aCArIGZyYW1lTnVtYmVyICsgdGhpcy5maWxlVHlwZTtcbiAgICAgICAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2U7XG4gICAgICAgICAgICBpbWcuc3JjID0gZmlsZW5hbWU7XG5cbiAgICAgICAgICAgIHZhciBwcm9taXNlID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgaW1nLm9ubG9hZCA9IHJlc29sdmU7XG4gICAgICAgICAgICAgICAgaW1nLm9uZXJyb3IgPSByZWplY3Q7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcHJvbWlzZXMucHVzaChwcm9taXNlKTtcblxuICAgICAgICAgICAgdGhpcy5zZXF1ZW5jZS5wdXNoKGltZyk7XG4gICAgICAgIH1cblxuICAgICAgICBQcm9taXNlLmFsbChwcm9taXNlcykudGhlbigoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlckZyYW1lKCk7XG4gICAgICAgICAgICB0aGlzLmxvYWRDYWxsYmFjaygpO1xuICAgICAgICB9KS5jYXRjaCgoZSkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGdldFNjcm9sbEZyYW1lTnVtYmVyKCkge1xuICAgICAgICB2YXIgc2Nyb2xsUGVyY2VudGFnZSA9ICh0aGlzLnNjcm9sbE9mZnNldC8odGhpcy5zY3JvbGxIZWlnaHQtdGhpcy5jbGllbnRIZWlnaHQpKSoxMDA7XG4gICAgICAgIHZhciBjdXJyZW50RnJhbWVOdW1iZXIgPSBNYXRoLnJvdW5kKHNjcm9sbFBlcmNlbnRhZ2UqdGhpcy5zZXF1ZW5jZUxlbmd0aC8xMDApO1xuICAgICAgICByZXR1cm4gY3VycmVudEZyYW1lTnVtYmVyO1xuICAgIH1cblxuICAgIGdldEF1dG9QbGF5RnJhbWVOdW1iZXIoKSB7XG4gICAgICAgIHJldHVybiBNYXRoLnJvdW5kKHRoaXMuZnBzICogdGhpcy5wbGF5T2Zmc2V0KTtcbiAgICB9XG5cbiAgICBnZXROZXh0RnJhbWVOdW1iZXIoKSB7XG4gICAgICAgIGlmICh0aGlzLmF1dG9QbGF5KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRBdXRvUGxheUZyYW1lTnVtYmVyKCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5nZXRTY3JvbGxGcmFtZU51bWJlcigpO1xuICAgIH1cblxuICAgIHN5bmNTY3JvbGxQb3NpdGlvbigpIHtcbiAgICAgICAgdGhpcy5zY3JvbGxPZmZzZXQgPSBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcDtcbiAgICB9XG5cbiAgICBzeW5jQXV0b1BsYXlQb3NpdGlvbigpIHtcbiAgICAgICAgY29uc3Qgbm93ID0gK25ldyBEYXRlKCk7XG4gICAgICAgIGlmICghdGhpcy5zdGFydFRpbWUpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRUaW1lID0gbm93O1xuICAgICAgICAgICAgdGhpcy5pc1BhdXNlZCA9IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF0aGlzLmlzUGF1c2VkKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXlPZmZzZXQgPSAoKG5vdyAtIHRoaXMuc3RhcnRUaW1lKSAvIDEwMDApICUgKHRoaXMuc2VxdWVuY2VMZW5ndGggLyB0aGlzLmZwcyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzeW5jUGxheVBvc2l0aW9uKCkge1xuICAgICAgICAvLyBubyBzY3JvbGwgdHJhY2tpbmcgZm9yIGF1dG9wbGF5XG4gICAgICAgIGlmICh0aGlzLmF1dG9QbGF5KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zeW5jQXV0b1BsYXlQb3NpdGlvbigpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuc3luY1Njcm9sbFBvc2l0aW9uKCk7XG4gICAgfVxuXG4gICAgZHJhd0ltYWdlKGZyYW1lKSB7XG5cbiAgICAgICAgaWYoZnJhbWUgPj0gMCAmJiBmcmFtZSA8IHRoaXMuc2VxdWVuY2UubGVuZ3RoKSB7XG4gICAgICAgICAgICAvLyB0aGlzLmNvbnRleHQuY2xlYXJSZWN0KDAsIDAsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQpO1xuICAgICAgICAgICAgaWYodGhpcy5zZXF1ZW5jZVtmcmFtZV0uY29tcGxldGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRleHQuZHJhd0ltYWdlKHRoaXMuc2VxdWVuY2VbZnJhbWVdLCAwLCAwLCB0aGlzLmNhbnZhcy53aWR0aCwgdGhpcy5jYW52YXMuaGVpZ2h0KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJUaGUgY3VycmVudCBmcmFtZSBoYXMgbm90IGJlZW4gbG9hZGVkLiBQbGVhc2UgZW5zdXJlIGFsbCBpbWFnZXMgYXJlIGxvYWRlZCBiZWZvcmUgdXBkYXRpbmcgdGhlIGNhbnZhcy5cIilcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgcmVuZGVyRnJhbWUoKSB7XG5cbiAgICAgICAgdGhpcy5zeW5jUGxheVBvc2l0aW9uKCk7XG5cbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyRnJhbWUoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5wcmV2aW91c0ZyYW1lID0gdGhpcy5jdXJyZW50RnJhbWU7XG4gICAgICAgIHRoaXMuY3VycmVudEZyYW1lID0gdGhpcy5nZXROZXh0RnJhbWVOdW1iZXIoKTtcblxuICAgICAgICBpZiAoKHRoaXMuY3VycmVudEZyYW1lICE9IHRoaXMucHJldmlvdXNGcmFtZSkgfHwgdGhpcy5maXJzdExvYWQpIHtcbiAgICAgICAgICAgIHRoaXMuZHJhd0ltYWdlKHRoaXMuY3VycmVudEZyYW1lKTtcbiAgICAgICAgICAgIHRoaXMub25EcmF3ICYmIHRoaXMub25EcmF3LmNhbGwobnVsbCwgdGhpcy5wcmV2aW91c0ZyYW1lLCB0aGlzLmN1cnJlbnRGcmFtZSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmZpcnN0TG9hZCA9IGZhbHNlO1xuICAgIH1cblxufVxuXG5pZiAoIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUpIHtcbiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lID0gKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gd2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgICAgICAgICAgd2luZG93Lm1velJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCAvLyBjb21tZW50IG91dCBpZiBGRjQgaXMgc2xvdyAoaXQgY2FwcyBmcmFtZXJhdGUgYXQgfjMwZnBzOiBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD02MzAxMjcpXG4gICAgICAgICAgICB3aW5kb3cub1JlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgICAgICAgICAgd2luZG93Lm1zUmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiggLyogZnVuY3Rpb24gRnJhbWVSZXF1ZXN0Q2FsbGJhY2sgKi8gY2FsbGJhY2ssIC8qIERPTUVsZW1lbnQgRWxlbWVudCAqLyBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoY2FsbGJhY2ssIDEwMDAgLyA2MCk7XG4gICAgICAgICAgICB9O1xuICAgIH0pKCk7XG59XG5cbmlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZiBkZWZpbmUuYW1kID09PSAnb2JqZWN0JyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgZGVmaW5lKGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIENhbnZhc1NlcXVlbmNlO1xuICAgIH0pO1xufSBlbHNlIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gQ2FudmFzU2VxdWVuY2U7XG59IGVsc2Uge1xuICAgIHdpbmRvdy5DYW52YXNTZXF1ZW5jZSA9IENhbnZhc1NlcXVlbmNlO1xufVxuIl19
