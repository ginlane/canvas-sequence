"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),CanvasSequence=function(){function e(t,n,s,i,a,o,r){var u=arguments.length<=7||void 0===arguments[7]?e.PlayMode.SCROLL:arguments[7],c=arguments.length<=8||void 0===arguments[8]?24:arguments[8],h=!(arguments.length<=9||void 0===arguments[9])&&arguments[9];return _classCallCheck(this,e),"object"==typeof t?this.ctor(t):void this.ctor({canvas:t,sequencePath:n,sequenceStart:s,sequenceEnd:i,fileType:a,loadCallback:o,onDraw:r,mode:u,fps:c,playOnce:h})}return _createClass(e,[{key:"ctor",value:function(t){var n=t.canvas,s=t.sequencePath,i=t.sequenceStart,a=t.sequenceEnd,o=t.fileType,r=t.loadCallback,u=t.onDraw,c=t.mode,h=void 0===c?e.PlayMode.SCROLL:c,l=t.fps,d=void 0===l?24:l,f=t.isPaused,m=void 0!==f&&f,v=t.playOnce,y=void 0!==v&&v;this.sequence=[],this.canvas=document.getElementById(n),null!==this.canvas?this.context=this.canvas.getContext("2d"):console.log("Please ensure the lib is loaded when DOM is loaded."),this.sequencePath=s,this.sequenceStart=i,this.sequenceEnd=a,this.sequenceLength=this.sequenceEnd-this.sequenceStart,this.fileType=o||".png",this.progress=0,this.scrollHeight=document.body.scrollHeight,this.loadCallback=r||function(){},this.onDraw="function"==typeof u?u:null,this.mode=h,this.isPaused=m,this.firstLoopEnd=!1,this.fps=d,this.playOnce=y,this.loadSequence()}},{key:"pause",value:function(){this.isPaused=!0}},{key:"play",value:function(){if(this.isPaused){var e=+new Date;this.startTime=e-this.currentFrame/this.fps*1e3,this.isPaused=!1,this.firstLoopEnd=!1}}},{key:"addLeadingZeros",value:function(e){for(var t=this.sequenceEnd.toString().length,n=(e>0?e:-e)+"",s="",i=t-n.length;i>0;i--)s+="0";return s+=n,e>=0?s:"-"+s}},{key:"loadSequence",value:function(){for(var e=this,t=[],n=this.sequenceStart;n<=this.sequenceEnd;n++){var s=this.addLeadingZeros(n),i=this.sequencePath+s+this.fileType,a=new Image;a.src=i;var o=new Promise(function(e,t){a.onload=e,a.onerror=t});t.push(o),this.sequence.push(a)}Promise.all(t).then(function(){e.renderFrame(),e.loadCallback()})["catch"](function(e){console.log(e)})}},{key:"getNextFrameNumber",value:function(){return Math.min(this.sequenceLength,Math.max(0,Math.round(this.progress*this.sequenceLength)))}},{key:"syncScrollPosition",value:function(){var e=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;return e/this.scrollHeight}},{key:"syncAutoPlayPosition",value:function(){var e=+new Date;if(this.startTime||(this.startTime=e),!this.isPaused){var t=this.sequenceLength/this.fps,n=(e-this.startTime)/1e3%t;return n/t}return this.progress}},{key:"syncPlayPosition",value:function(){switch(this.mode){case e.PlayMode.AUTO:this.progress=this.syncAutoPlayPosition();break;case e.PlayMode.MANUAL:break;case e.PlayMode.SCROLL:default:this.progress=this.syncScrollPosition()}}},{key:"setProgress",value:function(e){this.progress=e}},{key:"drawImage",value:function(e){e>=0&&e<this.sequence.length&&(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.sequence[e].complete?this.context.drawImage(this.sequence[e],0,0,this.canvas.width,this.canvas.height):console.log("The current frame has not been loaded. Please ensure all images are loaded before updating the canvas."))}},{key:"renderFrame",value:function(){var e=this;this.syncPlayPosition(),this.playOnce&&this.firstLoopEnd&&this.pause(),requestAnimationFrame(function(){e.renderFrame()}),this.previousFrame=this.currentFrame,this.currentFrame=this.getNextFrameNumber(),(this.currentFrame!=this.previousFrame||this.firstLoad)&&(this.drawImage(this.currentFrame),this.onDraw&&this.onDraw.call(null,this.previousFrame,this.currentFrame)),this.getNextFrameNumber()===this.sequenceEnd-1&&(this.firstLoopEnd=!0),this.firstLoad=!1}}]),e}();CanvasSequence.PlayMode={SCROLL:"SCROLL",AUTO:"AUTO",MANUAL:"MANUAL"},window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}()),"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return CanvasSequence}):"undefined"!=typeof module&&module.exports?module.exports=CanvasSequence:window.CanvasSequence=CanvasSequence;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhbnZhc1NlcXVlbmNlLmpzIl0sIm5hbWVzIjpbIl9jbGFzc0NhbGxDaGVjayIsImluc3RhbmNlIiwiQ29uc3RydWN0b3IiLCJUeXBlRXJyb3IiLCJfY3JlYXRlQ2xhc3MiLCJkZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJpIiwibGVuZ3RoIiwiZGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5Iiwia2V5IiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwicHJvdG90eXBlIiwiQ2FudmFzU2VxdWVuY2UiLCJjYW52YXNPck9wdHMiLCJzZXF1ZW5jZVBhdGgiLCJzZXF1ZW5jZVN0YXJ0Iiwic2VxdWVuY2VFbmQiLCJmaWxlVHlwZSIsImxvYWRDYWxsYmFjayIsIm9uRHJhdyIsIm1vZGUiLCJhcmd1bWVudHMiLCJ1bmRlZmluZWQiLCJQbGF5TW9kZSIsIlNDUk9MTCIsImZwcyIsInBsYXlPbmNlIiwidGhpcyIsImN0b3IiLCJjYW52YXMiLCJ2YWx1ZSIsIl9yZWYiLCJfcmVmJG1vZGUiLCJfcmVmJGZwcyIsIl9yZWYkaXNQYXVzZWQiLCJpc1BhdXNlZCIsIl9yZWYkcGxheU9uY2UiLCJzZXF1ZW5jZSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJjb250ZXh0IiwiZ2V0Q29udGV4dCIsImNvbnNvbGUiLCJsb2ciLCJzZXF1ZW5jZUxlbmd0aCIsInByb2dyZXNzIiwic2Nyb2xsSGVpZ2h0IiwiYm9keSIsImZpcnN0TG9vcEVuZCIsImxvYWRTZXF1ZW5jZSIsIm5vdyIsIkRhdGUiLCJzdGFydFRpbWUiLCJjdXJyZW50RnJhbWUiLCJuIiwidG9TdHJpbmciLCJzdHIiLCJ6ZXJvcyIsIl90aGlzIiwicHJvbWlzZXMiLCJmcmFtZU51bWJlciIsImFkZExlYWRpbmdaZXJvcyIsImZpbGVuYW1lIiwiaW1nIiwiSW1hZ2UiLCJzcmMiLCJwcm9taXNlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJvbmxvYWQiLCJvbmVycm9yIiwicHVzaCIsImFsbCIsInRoZW4iLCJyZW5kZXJGcmFtZSIsImUiLCJNYXRoIiwibWluIiwibWF4Iiwicm91bmQiLCJzY3JvbGxPZmZzZXQiLCJ3aW5kb3ciLCJwYWdlWU9mZnNldCIsImRvY3VtZW50RWxlbWVudCIsInNjcm9sbFRvcCIsInNlcXVlbmNlRHVyYXRpb24iLCJwbGF5T2Zmc2V0IiwiQVVUTyIsInN5bmNBdXRvUGxheVBvc2l0aW9uIiwiTUFOVUFMIiwic3luY1Njcm9sbFBvc2l0aW9uIiwiZnJhbWUiLCJjbGVhclJlY3QiLCJ3aWR0aCIsImhlaWdodCIsImNvbXBsZXRlIiwiZHJhd0ltYWdlIiwiX3RoaXMyIiwic3luY1BsYXlQb3NpdGlvbiIsInBhdXNlIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwicHJldmlvdXNGcmFtZSIsImdldE5leHRGcmFtZU51bWJlciIsImZpcnN0TG9hZCIsImNhbGwiLCJ3ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJtb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJvUmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwibXNSZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJjYWxsYmFjayIsImVsZW1lbnQiLCJzZXRUaW1lb3V0IiwiZGVmaW5lIiwiYW1kIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUEsWUFJQSxTQUFTQSxpQkFBZ0JDLEVBQVVDLEdBQWUsS0FBTUQsWUFBb0JDLElBQWdCLEtBQU0sSUFBSUMsV0FBVSxxQ0FGaEgsR0FBSUMsY0FBZSxXQUFlLFFBQVNDLEdBQWlCQyxFQUFRQyxHQUFTLElBQUssR0FBSUMsR0FBSSxFQUFHQSxFQUFJRCxFQUFNRSxPQUFRRCxJQUFLLENBQUUsR0FBSUUsR0FBYUgsRUFBTUMsRUFBSUUsR0FBV0MsV0FBYUQsRUFBV0MsYUFBYyxFQUFPRCxFQUFXRSxjQUFlLEVBQVUsU0FBV0YsS0FBWUEsRUFBV0csVUFBVyxHQUFN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UixPQUFPc0YsS0FBSyxLQUFNOUUsS0FBSzJFLGNBQWUzRSxLQUFLMEIsZUFHOUQxQixLQUFLNEUsdUJBQXlCNUUsS0FBS1gsWUFBYyxJQUNsRFcsS0FBS3FCLGNBQWUsR0FHeEJyQixLQUFLNkUsV0FBWSxNQXpPbkI1RixJQWlQTkEsZ0JBQWVXLFVBR1hDLE9BQVEsU0FHUmdFLEtBQVEsT0FJUkUsT0FBUSxVQUdQUixPQUFPbUIsd0JBQ1JuQixPQUFPbUIsc0JBQXdCLFdBQzNCLE1BQU9uQixRQUFPd0IsNkJBQ1Z4QixPQUFPeUIsMEJBQ1B6QixPQUFPMEIsd0JBQ1AxQixPQUFPMkIseUJBQ1AsU0FBOENDLEVBQW1DQyxHQUM3RTdCLE9BQU84QixXQUFXRixFQUFVLElBQU8sU0FLN0Isa0JBQVhHLFNBQStDLGdCQUFmQSxRQUFPQyxLQUFvQkQsT0FBT0MsSUFDekVELE9BQU8sV0FDSCxNQUFPckcsa0JBRWMsbUJBQVh1RyxTQUEwQkEsT0FBT0MsUUFDL0NELE9BQU9DLFFBQVV4RyxlQUVqQnNFLE9BQU90RSxlQUFpQkEiLCJmaWxlIjoiY2FudmFzU2VxdWVuY2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBDYW52YXNTZXF1ZW5jZSB7XG5cbiAgICAvKipcbiAgICAgKiBAc2VlIGN0b3JcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgY2FudmFzT3JPcHRzLFxuICAgICAgICBzZXF1ZW5jZVBhdGgsXG4gICAgICAgIHNlcXVlbmNlU3RhcnQsXG4gICAgICAgIHNlcXVlbmNlRW5kLFxuICAgICAgICBmaWxlVHlwZSxcbiAgICAgICAgbG9hZENhbGxiYWNrLFxuICAgICAgICBvbkRyYXcsXG4gICAgICAgIG1vZGUgPSBDYW52YXNTZXF1ZW5jZS5QbGF5TW9kZS5TQ1JPTEwsXG4gICAgICAgIGZwcyA9IDI0LFxuICAgICAgICBwbGF5T25jZSA9IGZhbHNlXG4gICAgKSB7XG4gICAgICAgIGlmICh0eXBlb2YgY2FudmFzT3JPcHRzID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgLy8gZmlyc3QgcGFyYW0gaXMgYW4gb2JqZWN0IG9mIG9wdGlvbnNcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmN0b3IoY2FudmFzT3JPcHRzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY3Rvcih7XG4gICAgICAgICAgICBjYW52YXM6IGNhbnZhc09yT3B0cyxcbiAgICAgICAgICAgIHNlcXVlbmNlUGF0aCxcbiAgICAgICAgICAgIHNlcXVlbmNlU3RhcnQsXG4gICAgICAgICAgICBzZXF1ZW5jZUVuZCxcbiAgICAgICAgICAgIGZpbGVUeXBlLFxuICAgICAgICAgICAgbG9hZENhbGxiYWNrLFxuICAgICAgICAgICAgb25EcmF3LFxuICAgICAgICAgICAgbW9kZSxcbiAgICAgICAgICAgIGZwcyxcbiAgICAgICAgICAgIHBsYXlPbmNlXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcGFyYW0gb3B0cy5maWxlVHlwZSB7U3RyaW5nfSAtIHRoZSBmaWxlIGV4dGVuc2lvbiB5b3Ugd2FudCB0byB1c2UgKGV4LlxuICAgICAqICdqcGcnKVxuICAgICAqIEBwYXJhbSBvcHRzLmxvYWRDYWxsYmFjayB7ZnVuY3Rpb259IC0gYSBjYWxsYmFjayB0byBiZSBub3RpZmllZCB3aGVuIGFsbFxuICAgICAqIGltYWdlcyBhcmUgbG9hZGVkIGFuZCByZWFkeSB0byB1c2VcbiAgICAgKiBAcGFyYW0gb3B0cy5vbkRyYXcge2Z1bmN0aW9uKHByZXZpb3VzRnJhbWU6SW50LCBjdXJyZW50RnJhbWU6SW50KWB9IC0gYVxuICAgICAqIGNhbGxiYWNrIHRvIGJlIG5vdGlmaWVkIHdoZW4gdGhlIGRyYXduIGZyYW1lIGNoYW5nZXNcbiAgICAgKiBAcGFyYW0gW29wdHMubW9kZV0ge1N0cmluZ30gLSBEZWZhdWx0cyB0byBgJ1NDUk9MTCdgLiBNZXRob2QgdG8gdXNlIGZvclxuICAgICAqIGNvbnRyb2xsaW5nIHBsYXliYWNrIG9mIHRoZSBzZXF1ZW5jZVxuICAgICAqIFNlZSBgQ2FudmFzU2VxdWVuY2UuUGxheU1vZGVgIGZvciBmdWxsIGxpc3Qgb2Ygc3VwcG9ydGVkIHBsYXkgbW9kZXNcbiAgICAgKiBAcGFyYW0gb3B0cy5mcHMge051bWJlcn0gLSBEZWZhdWx0cyB0byBgMjRgLiBGcmFtZXMgcGVyIHNlY29uZCB0byB1c2UgZm9yXG4gICAgICogQHBhcmFtIG9wdHMuaXNQYXVzZWQge051bWJlcn0gLSBEZWZhdWx0cyB0byBgZmFsc2VgLiBgdHJ1ZWAgdG8gaW5pdGlhbGl6ZVxuICAgICAqIHdpdGggcGF1c2VkIGF1dG8gcGxheWJhY2sgc3RhdGUuXG4gICAgICogQHBhcmFtIG9wdHMucGxheU9uY2Uge0Jvb2xlYW59IC0gRGVmYXVsdHMgdG8gYGZhbHNlYC4gYSBmbGFnIHRvIG1ha2UgdGhlXG4gICAgICogc2VxdWVuY2UgcGxheSBvbmx5IG9uY2VcbiAgICAgKi9cbiAgICBjdG9yKHtcbiAgICAgIGNhbnZhcyxcbiAgICAgIHNlcXVlbmNlUGF0aCxcbiAgICAgIHNlcXVlbmNlU3RhcnQsXG4gICAgICBzZXF1ZW5jZUVuZCxcbiAgICAgIGZpbGVUeXBlLFxuICAgICAgbG9hZENhbGxiYWNrLFxuICAgICAgb25EcmF3LFxuICAgICAgbW9kZSA9IENhbnZhc1NlcXVlbmNlLlBsYXlNb2RlLlNDUk9MTCxcbiAgICAgIGZwcyA9IDI0LFxuICAgICAgaXNQYXVzZWQgPSBmYWxzZSxcbiAgICAgIHBsYXlPbmNlID0gZmFsc2VcbiAgICB9KSB7XG4gICAgICAgIHRoaXMuc2VxdWVuY2UgPSBbXTtcblxuICAgICAgICB0aGlzLmNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNhbnZhcyk7XG5cbiAgICAgICAgaWYodGhpcy5jYW52YXMgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuY29udGV4dCA9IHRoaXMuY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlBsZWFzZSBlbnN1cmUgdGhlIGxpYiBpcyBsb2FkZWQgd2hlbiBET00gaXMgbG9hZGVkLlwiKVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zZXF1ZW5jZVBhdGggPSBzZXF1ZW5jZVBhdGg7XG4gICAgICAgIHRoaXMuc2VxdWVuY2VTdGFydCA9IHNlcXVlbmNlU3RhcnQ7XG4gICAgICAgIHRoaXMuc2VxdWVuY2VFbmQgPSBzZXF1ZW5jZUVuZDtcbiAgICAgICAgdGhpcy5zZXF1ZW5jZUxlbmd0aCA9IHRoaXMuc2VxdWVuY2VFbmQgLSB0aGlzLnNlcXVlbmNlU3RhcnQ7XG5cbiAgICAgICAgdGhpcy5maWxlVHlwZSA9IGZpbGVUeXBlIHx8ICcucG5nJztcblxuICAgICAgICB0aGlzLnByb2dyZXNzID0gMDtcbiAgICAgICAgdGhpcy5zY3JvbGxIZWlnaHQgPSBkb2N1bWVudC5ib2R5LnNjcm9sbEhlaWdodDtcbiAgICAgICAgdGhpcy5sb2FkQ2FsbGJhY2sgPSBsb2FkQ2FsbGJhY2sgfHwgZnVuY3Rpb24oKSB7fTtcbiAgICAgICAgdGhpcy5vbkRyYXcgPSB0eXBlb2Ygb25EcmF3ID09PSAnZnVuY3Rpb24nID8gb25EcmF3IDogbnVsbDtcbiAgICAgICAgdGhpcy5tb2RlID0gbW9kZTtcbiAgICAgICAgdGhpcy5pc1BhdXNlZCA9IGlzUGF1c2VkO1xuICAgICAgICB0aGlzLmZpcnN0TG9vcEVuZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZwcyA9IGZwcztcbiAgICAgICAgdGhpcy5wbGF5T25jZSA9IHBsYXlPbmNlO1xuXG4gICAgICAgIHRoaXMubG9hZFNlcXVlbmNlKCk7XG4gICAgfVxuXG4gICAgcGF1c2UoKSB7XG4gICAgICAgIHRoaXMuaXNQYXVzZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIHBsYXkoKSB7XG4gICAgICAgIGlmICghdGhpcy5pc1BhdXNlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gcmVzZXQgc3RhcnRUaW1lIHNvIHRoYXQgaXQgaXMgcmVsYXRpdmUgdG8gdGhlIGN1cnJlbnQgcmVwbGF5IHRpbWVcbiAgICAgICAgY29uc3Qgbm93ID0gK25ldyBEYXRlKCk7XG4gICAgICAgIHRoaXMuc3RhcnRUaW1lID0gbm93IC0gKHRoaXMuY3VycmVudEZyYW1lIC8gdGhpcy5mcHMgKiAxMDAwKVxuICAgICAgICB0aGlzLmlzUGF1c2VkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZmlyc3RMb29wRW5kID0gZmFsc2U7XG4gICAgfVxuXG4gICAgYWRkTGVhZGluZ1plcm9zKG4pIHtcbiAgICAgICAgdmFyIGxlbmd0aCA9IHRoaXMuc2VxdWVuY2VFbmQudG9TdHJpbmcoKS5sZW5ndGg7XG4gICAgICAgIHZhciBzdHIgPSAobiA+IDAgPyBuIDogLW4pICsgXCJcIjtcbiAgICAgICAgdmFyIHplcm9zID0gXCJcIjtcbiAgICAgICAgZm9yICh2YXIgaSA9IGxlbmd0aCAtIHN0ci5sZW5ndGg7IGkgPiAwOyBpLS0pXG4gICAgICAgICAgICB6ZXJvcyArPSBcIjBcIjtcbiAgICAgICAgemVyb3MgKz0gc3RyO1xuICAgICAgICByZXR1cm4gbiA+PSAwID8gemVyb3MgOiBcIi1cIiArIHplcm9zO1xuICAgIH1cblxuICAgIGxvYWRTZXF1ZW5jZSgpIHtcbiAgICAgICAgdmFyIHByb21pc2VzID0gW107XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMuc2VxdWVuY2VTdGFydDsgaSA8PSB0aGlzLnNlcXVlbmNlRW5kOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBmcmFtZU51bWJlciA9IHRoaXMuYWRkTGVhZGluZ1plcm9zKGkpO1xuICAgICAgICAgICAgdmFyIGZpbGVuYW1lID0gdGhpcy5zZXF1ZW5jZVBhdGggKyBmcmFtZU51bWJlciArIHRoaXMuZmlsZVR5cGU7XG4gICAgICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlO1xuICAgICAgICAgICAgaW1nLnNyYyA9IGZpbGVuYW1lO1xuXG4gICAgICAgICAgICB2YXIgcHJvbWlzZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgIGltZy5vbmxvYWQgPSByZXNvbHZlO1xuICAgICAgICAgICAgICAgIGltZy5vbmVycm9yID0gcmVqZWN0O1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHByb21pc2VzLnB1c2gocHJvbWlzZSk7XG5cbiAgICAgICAgICAgIHRoaXMuc2VxdWVuY2UucHVzaChpbWcpO1xuICAgICAgICB9XG5cbiAgICAgICAgUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJGcmFtZSgpO1xuICAgICAgICAgICAgdGhpcy5sb2FkQ2FsbGJhY2soKTtcbiAgICAgICAgfSkuY2F0Y2goKGUpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBnZXROZXh0RnJhbWVOdW1iZXIoKSB7XG4gICAgICByZXR1cm4gTWF0aC5taW4oXG4gICAgICAgIHRoaXMuc2VxdWVuY2VMZW5ndGgsXG4gICAgICAgIE1hdGgubWF4KFxuICAgICAgICAgIDAsXG4gICAgICAgICAgTWF0aC5yb3VuZCh0aGlzLnByb2dyZXNzICogdGhpcy5zZXF1ZW5jZUxlbmd0aClcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBzeW5jU2Nyb2xsUG9zaXRpb24oKSB7XG4gICAgICAgIGNvbnN0IHNjcm9sbE9mZnNldCA9XG4gICAgICAgICAgICB3aW5kb3cucGFnZVlPZmZzZXQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCB8fCBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCB8fCAwO1xuICAgICAgICByZXR1cm4gc2Nyb2xsT2Zmc2V0IC8gdGhpcy5zY3JvbGxIZWlnaHQ7XG4gICAgfVxuXG4gICAgc3luY0F1dG9QbGF5UG9zaXRpb24oKSB7XG4gICAgICAgIGNvbnN0IG5vdyA9ICtuZXcgRGF0ZSgpO1xuICAgICAgICBpZiAoIXRoaXMuc3RhcnRUaW1lKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0VGltZSA9IG5vdztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy5pc1BhdXNlZCkge1xuICAgICAgICAgICAgY29uc3Qgc2VxdWVuY2VEdXJhdGlvbiA9IHRoaXMuc2VxdWVuY2VMZW5ndGggLyB0aGlzLmZwcztcbiAgICAgICAgICAgIC8vIE1vZHVsbyB0byBsb29wXG4gICAgICAgICAgICBjb25zdCBwbGF5T2Zmc2V0ID0gKChub3cgLSB0aGlzLnN0YXJ0VGltZSkgLyAxMDAwKSAlIHNlcXVlbmNlRHVyYXRpb247XG4gICAgICAgICAgICByZXR1cm4gcGxheU9mZnNldCAvIHNlcXVlbmNlRHVyYXRpb247XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5wcm9ncmVzcztcbiAgICB9XG5cbiAgICBzeW5jUGxheVBvc2l0aW9uKCkge1xuICAgICAgICBzd2l0Y2ggKHRoaXMubW9kZSkge1xuICAgICAgICAgICAgY2FzZSBDYW52YXNTZXF1ZW5jZS5QbGF5TW9kZS5BVVRPOiB7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9ncmVzcyA9IHRoaXMuc3luY0F1dG9QbGF5UG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY2FzZSBDYW52YXNTZXF1ZW5jZS5QbGF5TW9kZS5NQU5VQUw6XG4gICAgICAgICAgICAgICAgLy8gRG8gTm90aGluZ1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIENhbnZhc1NlcXVlbmNlLlBsYXlNb2RlLlNDUk9MTDpcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9ncmVzcyA9IHRoaXMuc3luY1Njcm9sbFBvc2l0aW9uKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzZXRQcm9ncmVzcyhwcm9ncmVzcykge1xuICAgICAgICB0aGlzLnByb2dyZXNzID0gcHJvZ3Jlc3M7XG4gICAgfVxuXG4gICAgZHJhd0ltYWdlKGZyYW1lKSB7XG4gICAgICAgIGlmKGZyYW1lID49IDAgJiYgZnJhbWUgPCB0aGlzLnNlcXVlbmNlLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5jb250ZXh0LmNsZWFyUmVjdCgwLCAwLCB0aGlzLmNhbnZhcy53aWR0aCwgdGhpcy5jYW52YXMuaGVpZ2h0KTtcbiAgICAgICAgICAgIGlmKHRoaXMuc2VxdWVuY2VbZnJhbWVdLmNvbXBsZXRlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb250ZXh0LmRyYXdJbWFnZSh0aGlzLnNlcXVlbmNlW2ZyYW1lXSwgMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVGhlIGN1cnJlbnQgZnJhbWUgaGFzIG5vdCBiZWVuIGxvYWRlZC4gUGxlYXNlIGVuc3VyZSBhbGwgaW1hZ2VzIGFyZSBsb2FkZWQgYmVmb3JlIHVwZGF0aW5nIHRoZSBjYW52YXMuXCIpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZW5kZXJGcmFtZSgpIHtcbiAgICAgICAgdGhpcy5zeW5jUGxheVBvc2l0aW9uKCk7XG4gICAgICAgIGlmICggdGhpcy5wbGF5T25jZSAmJiB0aGlzLmZpcnN0TG9vcEVuZCApIHtcbiAgICAgICAgICAgIHRoaXMucGF1c2UoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlckZyYW1lKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMucHJldmlvdXNGcmFtZSA9IHRoaXMuY3VycmVudEZyYW1lO1xuICAgICAgICB0aGlzLmN1cnJlbnRGcmFtZSA9IHRoaXMuZ2V0TmV4dEZyYW1lTnVtYmVyKCk7XG5cbiAgICAgICAgaWYgKCh0aGlzLmN1cnJlbnRGcmFtZSAhPSB0aGlzLnByZXZpb3VzRnJhbWUpIHx8IHRoaXMuZmlyc3RMb2FkKSB7XG4gICAgICAgICAgICB0aGlzLmRyYXdJbWFnZSh0aGlzLmN1cnJlbnRGcmFtZSk7XG4gICAgICAgICAgICB0aGlzLm9uRHJhdyAmJiB0aGlzLm9uRHJhdy5jYWxsKG51bGwsIHRoaXMucHJldmlvdXNGcmFtZSwgdGhpcy5jdXJyZW50RnJhbWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCB0aGlzLmdldE5leHRGcmFtZU51bWJlcigpID09PSB0aGlzLnNlcXVlbmNlRW5kIC0gMSApIHtcbiAgICAgICAgICAgIHRoaXMuZmlyc3RMb29wRW5kID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZmlyc3RMb2FkID0gZmFsc2U7XG4gICAgfVxuXG59XG5cbi8qKlxuICogU3VwcG9ydGVkIHBsYXliYWNrIGNvbnRyb2wgb3B0aW9uc1xuICovXG5DYW52YXNTZXF1ZW5jZS5QbGF5TW9kZSA9IHtcbiAgICAvLyBTQ1JPTEwgLSAoRGVmYXVsdCkgcHJvZ3Jlc3MgaXMgYm91bmQgdG8gc2Nyb2xsIHBvc2l0aW9uIHJlbGF0aXZlIHRvIGhlaWdodFxuICAgIC8vIG9mIGRvY3VtZW50XG4gICAgU0NST0xMOiAnU0NST0xMJyxcblxuICAgIC8vIEFVVE8gLSBub3QgYm91bmQgdG8gc2Nyb2xsLCBwbGF5cyBsaWtlIGEgcmVndWxhciB2aWRlb1xuICAgIEFVVE8gIDogJ0FVVE8nLFxuXG4gICAgLy8gTUFOVUFMIC0gcGxheWJhY2sgbWFuYWdlbWVudCBpcyBsZWZ0IHRvIHRoZSBvd25lci4gRnJhbWUgaXMgdXBkYXRhYmxlIHdpdGhcbiAgICAvLyBgLnNldFByb2dyZXNzYCBtZXRob2QuXG4gICAgTUFOVUFMOiAnTUFOVUFMJ1xufVxuXG5pZiAoIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUpIHtcbiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lID0gKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gd2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgICAgICAgICAgd2luZG93Lm1velJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCAvLyBjb21tZW50IG91dCBpZiBGRjQgaXMgc2xvdyAoaXQgY2FwcyBmcmFtZXJhdGUgYXQgfjMwZnBzOiBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD02MzAxMjcpXG4gICAgICAgICAgICB3aW5kb3cub1JlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgICAgICAgICAgd2luZG93Lm1zUmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiggLyogZnVuY3Rpb24gRnJhbWVSZXF1ZXN0Q2FsbGJhY2sgKi8gY2FsbGJhY2ssIC8qIERPTUVsZW1lbnQgRWxlbWVudCAqLyBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoY2FsbGJhY2ssIDEwMDAgLyA2MCk7XG4gICAgICAgICAgICB9O1xuICAgIH0pKCk7XG59XG5cbmlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZiBkZWZpbmUuYW1kID09PSAnb2JqZWN0JyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgZGVmaW5lKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gQ2FudmFzU2VxdWVuY2U7XG4gICAgfSk7XG59IGVsc2UgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBDYW52YXNTZXF1ZW5jZTtcbn0gZWxzZSB7XG4gICAgd2luZG93LkNhbnZhc1NlcXVlbmNlID0gQ2FudmFzU2VxdWVuY2U7XG59XG4iXX0=
