"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}(),CanvasSequence=function(){function e(n,t,i,s,a,o){_classCallCheck(this,e),this.sequence=[],this.canvas=document.getElementById(n),null!==this.canvas?this.context=this.canvas.getContext("2d"):console.log("Please ensure the lib is loaded when DOM is loaded."),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.sequencePath=t,this.sequenceStart=i,this.sequenceEnd=s,this.sequenceLength=this.sequenceEnd-this.sequenceStart,this.fileType=a||".png",this.scrollHeight=document.body.scrollHeight,this.scrollOffset=document.body.scrollTop,this.clientHeight=window.innerHeight,this.loadCallback=o||function(){},this.loadSequence()}return _createClass(e,[{key:"addLeadingZeros",value:function(e){for(var n=this.sequenceEnd.toString().length,t=(e>0?e:-e)+"",i="",s=n-t.length;s>0;s--)i+="0";return i+=t,e>=0?i:"-"+i}},{key:"loadSequence",value:function(){for(var e=this,n=[],t=this.sequenceStart;t<=this.sequenceEnd;t++){var i=this.addLeadingZeros(t),s=this.sequencePath+i+this.fileType,a=new Image;a.src=s;var o=new Promise(function(e,n){a.onload=e,a.onerror=n});n.push(o),this.sequence.push(a)}Promise.all(n).then(function(){e.renderFrame()})["catch"](function(e){console.log(e)})}},{key:"getNextFrameNumber",value:function(){var e=this.scrollOffset/(this.scrollHeight-this.clientHeight)*100,n=Math.round(e*this.sequenceLength/100);return n}},{key:"syncScrollPosition",value:function(){this.scrollOffset=document.body.scrollTop}},{key:"drawImage",value:function(e){e>=0&&e<this.sequence.length&&(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.sequence[e].complete?this.context.drawImage(this.sequence[e],0,0,this.canvas.width,this.canvas.height):console.log("The current frame has not been loaded. Please ensure all images are loaded before updating the canvas."))}},{key:"renderFrame",value:function(){var e=this;this.syncScrollPosition(),requestAnimationFrame(function(){e.renderFrame()}),this.previousFrame=this.currentFrame,this.currentFrame=this.getNextFrameNumber(),(this.currentFrame!=this.previousFrame||this.firstLoad)&&this.drawImage(this.currentFrame),this.firstLoad=!1}}]),e}();window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,n){window.setTimeout(e,1e3/60)}}()),"function"==typeof define&&define.amd?define("CanvasSequence",CanvasSequence):"undefined"!=typeof module&&module.exports?module.exports=CanvasSequence:window.CanvasSequence=CanvasSequence;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhbnZhc1NlcXVlbmNlLmpzIl0sIm5hbWVzIjpbIl9jbGFzc0NhbGxDaGVjayIsImluc3RhbmNlIiwiQ29uc3RydWN0b3IiLCJUeXBlRXJyb3IiLCJfY3JlYXRlQ2xhc3MiLCJkZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJpIiwibGVuZ3RoIiwiZGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5Iiwia2V5IiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwicHJvdG90eXBlIiwiQ2FudmFzU2VxdWVuY2UiLCJjYW52YXMiLCJzZXF1ZW5jZVBhdGgiLCJzZXF1ZW5jZVN0YXJ0Iiwic2VxdWVuY2VFbmQiLCJmaWxlVHlwZSIsImxvYWRDYWxsYmFjayIsInRoaXMiLCJzZXF1ZW5jZSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJjb250ZXh0IiwiZ2V0Q29udGV4dCIsImNvbnNvbGUiLCJsb2ciLCJ3aWR0aCIsIndpbmRvdyIsImlubmVyV2lkdGgiLCJoZWlnaHQiLCJpbm5lckhlaWdodCIsInNlcXVlbmNlTGVuZ3RoIiwic2Nyb2xsSGVpZ2h0IiwiYm9keSIsInNjcm9sbE9mZnNldCIsInNjcm9sbFRvcCIsImNsaWVudEhlaWdodCIsImxvYWRTZXF1ZW5jZSIsInZhbHVlIiwibiIsInRvU3RyaW5nIiwic3RyIiwiemVyb3MiLCJfdGhpcyIsInByb21pc2VzIiwiZnJhbWVOdW1iZXIiLCJhZGRMZWFkaW5nWmVyb3MiLCJmaWxlbmFtZSIsImltZyIsIkltYWdlIiwic3JjIiwicHJvbWlzZSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0Iiwib25sb2FkIiwib25lcnJvciIsInB1c2giLCJhbGwiLCJ0aGVuIiwicmVuZGVyRnJhbWUiLCJlIiwic2Nyb2xsUGVyY2VudGFnZSIsImN1cnJlbnRGcmFtZU51bWJlciIsIk1hdGgiLCJyb3VuZCIsImZyYW1lIiwiY2xlYXJSZWN0IiwiY29tcGxldGUiLCJkcmF3SW1hZ2UiLCJfdGhpczIiLCJzeW5jU2Nyb2xsUG9zaXRpb24iLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJwcmV2aW91c0ZyYW1lIiwiY3VycmVudEZyYW1lIiwiZ2V0TmV4dEZyYW1lTnVtYmVyIiwiZmlyc3RMb2FkIiwid2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwibW96UmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwib1JlcXVlc3RBbmltYXRpb25GcmFtZSIsIm1zUmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwiY2FsbGJhY2siLCJlbGVtZW50Iiwic2V0VGltZW91dCIsImRlZmluZSIsImFtZCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBLFlBSUEsU0FBU0EsaUJBQWdCQyxFQUFVQyxHQUFlLEtBQU1ELFlBQW9CQyxJQUFnQixLQUFNLElBQUlDLFdBQVUscUNBRmhILEdBQUlDLGNBQWUsV0FBZSxRQUFTQyxHQUFpQkMsRUFBUUMsR0FBUyxJQUFLLEdBQUlDLEdBQUksRUFBR0EsRUFBSUQsRUFBTUUsT0FBUUQsSUFBSyxDQUFFLEdBQUlFLEdBQWFILEVBQU1DLEVBQUlFLEdBQVdDLFdBQWFELEVBQVdDLGFBQWMsRUFBT0QsRUFBV0UsY0FBZSxFQUFVLFNBQVdGLEtBQVlBLEVBQVdHLFVBQVcsR0FBTUMsT0FBT0MsZUFBZVQsRUFBUUksRUFBV00sSUFBS04sSUFBaUIsTUFBTyxVQUFVUixFQUFhZSxFQUFZQyxHQUFpSixNQUE5SEQsSUFBWVosRUFBaUJILEVBQVlpQixVQUFXRixHQUFpQkMsR0FBYWIsRUFBaUJILEVBQWFnQixHQUFxQmhCLE1BRjNoQmtCLGVBQWMsV0FFTCxRQUZUQSxHQUVVQyxFQUFRQyxFQUFjQyxFQUFlQyxFQUFhQyxFQUFVQyxHQU1wRTFCLGdCQUFnQjJCLEtBUmxCUCxHQUlFTyxLQUFLQyxZQUVMRCxLQUFLTixPQUFTUSxTQUFTQyxlQUFlVCxHQUVuQixPQUFoQk0sS0FBS04sT0FDSk0sS0FB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QU9rRCw2QkFDVmxELE9BQU9tRCwwQkFDUG5ELE9BQU9vRCx3QkFDUHBELE9BQU9xRCx5QkFDUCxTQUE4Q0MsRUFBbUNDLEdBQzdFdkQsT0FBT3dELFdBQVdGLEVBQVUsSUFBTyxTQUs3QixrQkFBWEcsU0FBeUJBLE9BQU9DLElBQ3ZDRCxPQUFPLGlCQUFrQnpFLGdCQUNBLG1CQUFYMkUsU0FBMEJBLE9BQU9DLFFBQy9DRCxPQUFPQyxRQUFVNUUsZUFFakJnQixPQUFPaEIsZUFBaUJBIiwiZmlsZSI6ImNhbnZhc1NlcXVlbmNlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgQ2FudmFzU2VxdWVuY2Uge1xuXG4gICAgY29uc3RydWN0b3IoY2FudmFzLCBzZXF1ZW5jZVBhdGgsIHNlcXVlbmNlU3RhcnQsIHNlcXVlbmNlRW5kLCBmaWxlVHlwZSwgbG9hZENhbGxiYWNrKSB7XG5cbiAgICAgICAgdGhpcy5zZXF1ZW5jZSA9IFtdO1xuXG4gICAgICAgIHRoaXMuY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY2FudmFzKTtcblxuICAgICAgICBpZih0aGlzLmNhbnZhcyAhPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5jb250ZXh0ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiUGxlYXNlIGVuc3VyZSB0aGUgbGliIGlzIGxvYWRlZCB3aGVuIERPTSBpcyBsb2FkZWQuXCIpXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmNhbnZhcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgICAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG5cbiAgICAgICAgdGhpcy5zZXF1ZW5jZVBhdGggPSBzZXF1ZW5jZVBhdGg7XG4gICAgICAgIHRoaXMuc2VxdWVuY2VTdGFydCA9IHNlcXVlbmNlU3RhcnQ7XG4gICAgICAgIHRoaXMuc2VxdWVuY2VFbmQgPSBzZXF1ZW5jZUVuZDtcbiAgICAgICAgdGhpcy5zZXF1ZW5jZUxlbmd0aCA9IHRoaXMuc2VxdWVuY2VFbmQgLSB0aGlzLnNlcXVlbmNlU3RhcnQ7XG5cbiAgICAgICAgdGhpcy5maWxlVHlwZSA9IGZpbGVUeXBlIHx8ICcucG5nJztcblxuICAgICAgICB0aGlzLnNjcm9sbEhlaWdodCA9IGRvY3VtZW50LmJvZHkuc2Nyb2xsSGVpZ2h0O1xuICAgICAgICB0aGlzLnNjcm9sbE9mZnNldCA9IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wO1xuICAgICAgICB0aGlzLmNsaWVudEhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcblxuICAgICAgICB0aGlzLmxvYWRDYWxsYmFjayA9IGxvYWRDYWxsYmFjayB8fCBmdW5jdGlvbigpIHt9O1xuXG4gICAgICAgIHRoaXMubG9hZFNlcXVlbmNlKCk7XG4gICAgfVxuXG4gICAgYWRkTGVhZGluZ1plcm9zKG4pIHtcbiAgICAgICAgdmFyIGxlbmd0aCA9IHRoaXMuc2VxdWVuY2VFbmQudG9TdHJpbmcoKS5sZW5ndGg7XG4gICAgICAgIHZhciBzdHIgPSAobiA+IDAgPyBuIDogLW4pICsgXCJcIjtcbiAgICAgICAgdmFyIHplcm9zID0gXCJcIjtcbiAgICAgICAgZm9yICh2YXIgaSA9IGxlbmd0aCAtIHN0ci5sZW5ndGg7IGkgPiAwOyBpLS0pXG4gICAgICAgICAgICB6ZXJvcyArPSBcIjBcIjtcbiAgICAgICAgemVyb3MgKz0gc3RyO1xuICAgICAgICByZXR1cm4gbiA+PSAwID8gemVyb3MgOiBcIi1cIiArIHplcm9zO1xuICAgIH1cblxuICAgIGxvYWRTZXF1ZW5jZSgpIHtcblxuICAgICAgICB2YXIgcHJvbWlzZXMgPSBbXTtcblxuICAgICAgICBmb3IodmFyIGkgPSB0aGlzLnNlcXVlbmNlU3RhcnQ7IGkgPD0gdGhpcy5zZXF1ZW5jZUVuZDsgaSsrKSB7XG5cbiAgICAgICAgICAgIHZhciBmcmFtZU51bWJlciA9IHRoaXMuYWRkTGVhZGluZ1plcm9zKGkpO1xuICAgICAgICAgICAgdmFyIGZpbGVuYW1lID0gdGhpcy5zZXF1ZW5jZVBhdGggKyBmcmFtZU51bWJlciArIHRoaXMuZmlsZVR5cGU7XG4gICAgICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlO1xuICAgICAgICAgICAgaW1nLnNyYyA9IGZpbGVuYW1lO1xuXG4gICAgICAgICAgICB2YXIgcHJvbWlzZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgICAgIGltZy5vbmxvYWQgPSByZXNvbHZlO1xuICAgICAgICAgICAgICAgIGltZy5vbmVycm9yID0gcmVqZWN0O1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHByb21pc2VzLnB1c2gocHJvbWlzZSk7XG5cbiAgICAgICAgICAgIHRoaXMuc2VxdWVuY2UucHVzaChpbWcpO1xuICAgICAgICB9XG5cbiAgICAgICAgUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJGcmFtZSgpO1xuICAgICAgICB9KS5jYXRjaCgoZSkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGdldE5leHRGcmFtZU51bWJlcigpIHtcbiAgICAgICAgdmFyIHNjcm9sbFBlcmNlbnRhZ2UgPSAodGhpcy5zY3JvbGxPZmZzZXQvKHRoaXMuc2Nyb2xsSGVpZ2h0LXRoaXMuY2xpZW50SGVpZ2h0KSkqMTAwO1xuICAgICAgICB2YXIgY3VycmVudEZyYW1lTnVtYmVyID0gTWF0aC5yb3VuZChzY3JvbGxQZXJjZW50YWdlKnRoaXMuc2VxdWVuY2VMZW5ndGgvMTAwKTtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRGcmFtZU51bWJlcjtcbiAgICB9XG5cbiAgICBzeW5jU2Nyb2xsUG9zaXRpb24oKSB7XG4gICAgICAgIHRoaXMuc2Nyb2xsT2Zmc2V0ID0gZG9jdW1lbnQuYm9keS5zY3JvbGxUb3A7XG4gICAgfVxuXG4gICAgZHJhd0ltYWdlKGZyYW1lKSB7XG5cbiAgICAgICAgaWYoZnJhbWUgPj0gMCAmJiBmcmFtZSA8IHRoaXMuc2VxdWVuY2UubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRleHQuY2xlYXJSZWN0KDAsIDAsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQpO1xuICAgICAgICAgICAgaWYodGhpcy5zZXF1ZW5jZVtmcmFtZV0uY29tcGxldGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRleHQuZHJhd0ltYWdlKHRoaXMuc2VxdWVuY2VbZnJhbWVdLCAwLCAwLCB0aGlzLmNhbnZhcy53aWR0aCwgdGhpcy5jYW52YXMuaGVpZ2h0KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJUaGUgY3VycmVudCBmcmFtZSBoYXMgbm90IGJlZW4gbG9hZGVkLiBQbGVhc2UgZW5zdXJlIGFsbCBpbWFnZXMgYXJlIGxvYWRlZCBiZWZvcmUgdXBkYXRpbmcgdGhlIGNhbnZhcy5cIilcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgcmVuZGVyRnJhbWUoKSB7XG5cbiAgICAgICAgdGhpcy5zeW5jU2Nyb2xsUG9zaXRpb24oKTtcblxuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJGcmFtZSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnByZXZpb3VzRnJhbWUgPSB0aGlzLmN1cnJlbnRGcmFtZTtcbiAgICAgICAgdGhpcy5jdXJyZW50RnJhbWUgPSB0aGlzLmdldE5leHRGcmFtZU51bWJlcigpO1xuXG4gICAgICAgIGlmKCAodGhpcy5jdXJyZW50RnJhbWUgIT0gdGhpcy5wcmV2aW91c0ZyYW1lKSB8fCB0aGlzLmZpcnN0TG9hZCkge1xuICAgICAgICAgICAgdGhpcy5kcmF3SW1hZ2UodGhpcy5jdXJyZW50RnJhbWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5maXJzdExvYWQgPSBmYWxzZTtcbiAgICB9XG5cbn1cblxuaWYgKCF3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKSB7XG4gICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IChmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHdpbmRvdy53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcbiAgICAgICAgICAgIHdpbmRvdy5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgLy8gY29tbWVudCBvdXQgaWYgRkY0IGlzIHNsb3cgKGl0IGNhcHMgZnJhbWVyYXRlIGF0IH4zMGZwczogaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9NjMwMTI3KVxuICAgICAgICAgICAgd2luZG93Lm9SZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcbiAgICAgICAgICAgIHdpbmRvdy5tc1JlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24oIC8qIGZ1bmN0aW9uIEZyYW1lUmVxdWVzdENhbGxiYWNrICovIGNhbGxiYWNrLCAvKiBET01FbGVtZW50IEVsZW1lbnQgKi8gZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGNhbGxiYWNrLCAxMDAwIC8gNjApO1xuICAgICAgICAgICAgfTtcbiAgICB9KSgpO1xufVxuXG5pZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgZGVmaW5lKCdDYW52YXNTZXF1ZW5jZScsIENhbnZhc1NlcXVlbmNlKTtcbn0gZWxzZSBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IENhbnZhc1NlcXVlbmNlO1xufSBlbHNlIHtcbiAgICB3aW5kb3cuQ2FudmFzU2VxdWVuY2UgPSBDYW52YXNTZXF1ZW5jZTtcbn0iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=