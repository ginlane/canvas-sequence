"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}(),CanvasSequence=function(){function e(n,t,i,a,s,o){var r=arguments.length<=6||void 0===arguments[6]?[]:arguments[6];_classCallCheck(this,e),this.sequence=[],this.canvas=document.getElementById(n),null!==this.canvas?this.context=this.canvas.getContext("2d"):console.log("Please ensure the lib is loaded when DOM is loaded."),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.sequencePath=t,this.sequenceStart=i,this.sequenceEnd=a,this.sequenceLength=this.sequenceEnd-this.sequenceStart,this.fileType=s||".png",this.scrollHeight=document.body.scrollHeight,this.scrollOffset=document.body.scrollTop,this.clientHeight=window.innerHeight,this.loadCallback=o||function(){},this.frameCallbacks=r,this.loadSequence()}return _createClass(e,[{key:"addLeadingZeros",value:function(e){for(var n=this.sequenceEnd.toString().length,t=(e>0?e:-e)+"",i="",a=n-t.length;a>0;a--)i+="0";return i+=t,e>=0?i:"-"+i}},{key:"loadSequence",value:function(){for(var e=this,n=[],t=this.sequenceStart;t<=this.sequenceEnd;t++){var i=this.addLeadingZeros(t),a=this.sequencePath+i+this.fileType,s=new Image;s.src=a;var o=new Promise(function(e,n){s.onload=e,s.onerror=n});n.push(o),this.sequence.push(s)}Promise.all(n).then(function(){e.renderFrame(),e.loadCallback()})["catch"](function(e){console.log(e)})}},{key:"getNextFrameNumber",value:function(){var e=this.scrollOffset/(this.scrollHeight-this.clientHeight)*100,n=Math.round(e*this.sequenceLength/100);return n}},{key:"syncScrollPosition",value:function(){this.scrollOffset=document.body.scrollTop}},{key:"drawImage",value:function(e){e>=0&&e<this.sequence.length&&(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.sequence[e].complete?this.context.drawImage(this.sequence[e],0,0,this.canvas.width,this.canvas.height):console.log("The current frame has not been loaded. Please ensure all images are loaded before updating the canvas."))}},{key:"notifyFrameCallbacks",value:function(e,n,t){var i=this;t.forEach(function(t){var a=t.frame,s=t.onEnter,o=void 0===s?function(){}:s,r=t.onLeave,c=void 0===r?function(){}:r;n<a&&a<=e?c.call(i):e<a&&a<=n&&o.call(i)})}},{key:"renderFrame",value:function(){var e=this;this.syncScrollPosition(),requestAnimationFrame(function(){e.renderFrame()}),this.previousFrame=this.currentFrame,this.currentFrame=this.getNextFrameNumber(),(this.currentFrame!=this.previousFrame||this.firstLoad)&&(this.drawImage(this.currentFrame),this.notifyFrameCallbacks(this.previousFrame,this.currentFrame,this.frameCallbacks)),this.firstLoad=!1}}]),e}();window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,n){window.setTimeout(e,1e3/60)}}()),"function"==typeof define&&define.amd?define("CanvasSequence",CanvasSequence):"undefined"!=typeof module&&module.exports?module.exports=CanvasSequence:window.CanvasSequence=CanvasSequence;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhbnZhc1NlcXVlbmNlLmpzIl0sIm5hbWVzIjpbIl9jbGFzc0NhbGxDaGVjayIsImluc3RhbmNlIiwiQ29uc3RydWN0b3IiLCJUeXBlRXJyb3IiLCJfY3JlYXRlQ2xhc3MiLCJkZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJpIiwibGVuZ3RoIiwiZGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5Iiwia2V5IiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwicHJvdG90eXBlIiwiQ2FudmFzU2VxdWVuY2UiLCJjYW52YXMiLCJzZXF1ZW5jZVBhdGgiLCJzZXF1ZW5jZVN0YXJ0Iiwic2VxdWVuY2VFbmQiLCJmaWxlVHlwZSIsImxvYWRDYWxsYmFjayIsImZyYW1lQ2FsbGJhY2tzIiwiYXJndW1lbnRzIiwidW5kZWZpbmVkIiwidGhpcyIsInNlcXVlbmNlIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImNvbnRleHQiLCJnZXRDb250ZXh0IiwiY29uc29sZSIsImxvZyIsIndpZHRoIiwid2luZG93IiwiaW5uZXJXaWR0aCIsImhlaWdodCIsImlubmVySGVpZ2h0Iiwic2VxdWVuY2VMZW5ndGgiLCJzY3JvbGxIZWlnaHQiLCJib2R5Iiwic2Nyb2xsT2Zmc2V0Iiwic2Nyb2xsVG9wIiwiY2xpZW50SGVpZ2h0IiwibG9hZFNlcXVlbmNlIiwidmFsdWUiLCJuIiwidG9TdHJpbmciLCJzdHIiLCJ6ZXJvcyIsIl90aGlzIiwicHJvbWlzZXMiLCJmcmFtZU51bWJlciIsImFkZExlYWRpbmdaZXJvcyIsImZpbGVuYW1lIiwiaW1nIiwiSW1hZ2UiLCJzcmMiLCJwcm9taXNlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJvbmxvYWQiLCJvbmVycm9yIiwicHVzaCIsImFsbCIsInRoZW4iLCJyZW5kZXJGcmFtZSIsImUiLCJzY3JvbGxQZXJjZW50YWdlIiwiY3VycmVudEZyYW1lTnVtYmVyIiwiTWF0aCIsInJvdW5kIiwiZnJhbWUiLCJjbGVhclJlY3QiLCJjb21wbGV0ZSIsImRyYXdJbWFnZSIsInByZXZpb3VzRnJhbWUiLCJjdXJyZW50RnJhbWUiLCJfdGhpczIiLCJmb3JFYWNoIiwiX3JlZiIsIl9yZWYkb25FbnRlciIsIm9uRW50ZXIiLCJfcmVmJG9uTGVhdmUiLCJvbkxlYXZlIiwiY2FsbCIsIl90aGlzMyIsInN5bmNTY3JvbGxQb3NpdGlvbiIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImdldE5leHRGcmFtZU51bWJlciIsImZpcnN0TG9hZCIsIm5vdGlmeUZyYW1lQ2FsbGJhY2tzIiwid2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwibW96UmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwib1JlcXVlc3RBbmltYXRpb25GcmFtZSIsIm1zUmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwiY2FsbGJhY2siLCJlbGVtZW50Iiwic2V0VGltZW91dCIsImRlZmluZSIsImFtZCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBLFlBSUEsU0FBU0EsaUJBQWdCQyxFQUFVQyxHQUFlLEtBQU1ELFlBQW9CQyxJQUFnQixLQUFNLElBQUlDLFdBQVUscUNBRmhILEdBQUlDLGNBQWUsV0FBZSxRQUFTQyxHQUFpQkMsRUFBUUMsR0FBUyxJQUFLLEdBQUlDLEdBQUksRUFBR0EsRUFBSUQsRUFBTUUsT0FBUUQsSUFBSyxDQUFFLEdBQUlFLEdBQWFILEVBQU1DLEVBQUlFLEdBQVdDLFdBQWFELEVBQVdDLGFBQWMsRUFBT0QsRUFBV0UsY0FBZSxFQUFVLFNBQVdGLEtBQVlBLEVBQVdHLFVBQVcsR0FBTUMsT0FBT0MsZUFBZVQsRUFBUUksRUFBV00sSUFBS04sSUFBaUIsTUFBTyxVQUFVUixFQUFhZSxFQUFZQyxHQUFpSixNQUE5SEQsSUFBWVosRUFBaUJILEVBQVlpQixVQUFXRixHQUFpQkMsR0FBYWIsRUFBaUJILEVBQWFnQixHQUFxQmhCLE1BRjNoQmtC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Y2Uge1xuXG4gICAgY29uc3RydWN0b3IoY2FudmFzLCBzZXF1ZW5jZVBhdGgsIHNlcXVlbmNlU3RhcnQsIHNlcXVlbmNlRW5kLCBmaWxlVHlwZSwgbG9hZENhbGxiYWNrLCBmcmFtZUNhbGxiYWNrcyA9IFtdKSB7XG5cbiAgICAgICAgdGhpcy5zZXF1ZW5jZSA9IFtdO1xuXG4gICAgICAgIHRoaXMuY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY2FudmFzKTtcblxuICAgICAgICBpZih0aGlzLmNhbnZhcyAhPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5jb250ZXh0ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiUGxlYXNlIGVuc3VyZSB0aGUgbGliIGlzIGxvYWRlZCB3aGVuIERPTSBpcyBsb2FkZWQuXCIpXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmNhbnZhcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgICAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG5cbiAgICAgICAgdGhpcy5zZXF1ZW5jZVBhdGggPSBzZXF1ZW5jZVBhdGg7XG4gICAgICAgIHRoaXMuc2VxdWVuY2VTdGFydCA9IHNlcXVlbmNlU3RhcnQ7XG4gICAgICAgIHRoaXMuc2VxdWVuY2VFbmQgPSBzZXF1ZW5jZUVuZDtcbiAgICAgICAgdGhpcy5zZXF1ZW5jZUxlbmd0aCA9IHRoaXMuc2VxdWVuY2VFbmQgLSB0aGlzLnNlcXVlbmNlU3RhcnQ7XG5cbiAgICAgICAgdGhpcy5maWxlVHlwZSA9IGZpbGVUeXBlIHx8ICcucG5nJztcblxuICAgICAgICB0aGlzLnNjcm9sbEhlaWdodCA9IGRvY3VtZW50LmJvZHkuc2Nyb2xsSGVpZ2h0O1xuICAgICAgICB0aGlzLnNjcm9sbE9mZnNldCA9IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wO1xuICAgICAgICB0aGlzLmNsaWVudEhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcblxuICAgICAgICB0aGlzLmxvYWRDYWxsYmFjayA9IGxvYWRDYWxsYmFjayB8fCBmdW5jdGlvbigpIHt9O1xuXG4gICAgICAgIHRoaXMuZnJhbWVDYWxsYmFja3MgPSBmcmFtZUNhbGxiYWNrcztcblxuICAgICAgICB0aGlzLmxvYWRTZXF1ZW5jZSgpO1xuICAgIH1cblxuICAgIGFkZExlYWRpbmdaZXJvcyhuKSB7XG4gICAgICAgIHZhciBsZW5ndGggPSB0aGlzLnNlcXVlbmNlRW5kLnRvU3RyaW5nKCkubGVuZ3RoO1xuICAgICAgICB2YXIgc3RyID0gKG4gPiAwID8gbiA6IC1uKSArIFwiXCI7XG4gICAgICAgIHZhciB6ZXJvcyA9IFwiXCI7XG4gICAgICAgIGZvciAodmFyIGkgPSBsZW5ndGggLSBzdHIubGVuZ3RoOyBpID4gMDsgaS0tKVxuICAgICAgICAgICAgemVyb3MgKz0gXCIwXCI7XG4gICAgICAgIHplcm9zICs9IHN0cjtcbiAgICAgICAgcmV0dXJuIG4gPj0gMCA/IHplcm9zIDogXCItXCIgKyB6ZXJvcztcbiAgICB9XG5cbiAgICBsb2FkU2VxdWVuY2UoKSB7XG5cbiAgICAgICAgdmFyIHByb21pc2VzID0gW107XG5cbiAgICAgICAgZm9yKHZhciBpID0gdGhpcy5zZXF1ZW5jZVN0YXJ0OyBpIDw9IHRoaXMuc2VxdWVuY2VFbmQ7IGkrKykge1xuXG4gICAgICAgICAgICB2YXIgZnJhbWVOdW1iZXIgPSB0aGlzLmFkZExlYWRpbmdaZXJvcyhpKTtcbiAgICAgICAgICAgIHZhciBmaWxlbmFtZSA9IHRoaXMuc2VxdWVuY2VQYXRoICsgZnJhbWVOdW1iZXIgKyB0aGlzLmZpbGVUeXBlO1xuICAgICAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZTtcbiAgICAgICAgICAgIGltZy5zcmMgPSBmaWxlbmFtZTtcblxuICAgICAgICAgICAgdmFyIHByb21pc2UgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICBpbWcub25sb2FkID0gcmVzb2x2ZTtcbiAgICAgICAgICAgICAgICBpbWcub25lcnJvciA9IHJlamVjdDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBwcm9taXNlcy5wdXNoKHByb21pc2UpO1xuXG4gICAgICAgICAgICB0aGlzLnNlcXVlbmNlLnB1c2goaW1nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIFByb21pc2UuYWxsKHByb21pc2VzKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyRnJhbWUoKTtcbiAgICAgICAgICAgIHRoaXMubG9hZENhbGxiYWNrKCk7XG4gICAgICAgIH0pLmNhdGNoKChlKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZ2V0TmV4dEZyYW1lTnVtYmVyKCkge1xuICAgICAgICB2YXIgc2Nyb2xsUGVyY2VudGFnZSA9ICh0aGlzLnNjcm9sbE9mZnNldC8odGhpcy5zY3JvbGxIZWlnaHQtdGhpcy5jbGllbnRIZWlnaHQpKSoxMDA7XG4gICAgICAgIHZhciBjdXJyZW50RnJhbWVOdW1iZXIgPSBNYXRoLnJvdW5kKHNjcm9sbFBlcmNlbnRhZ2UqdGhpcy5zZXF1ZW5jZUxlbmd0aC8xMDApO1xuICAgICAgICByZXR1cm4gY3VycmVudEZyYW1lTnVtYmVyO1xuICAgIH1cblxuICAgIHN5bmNTY3JvbGxQb3NpdGlvbigpIHtcbiAgICAgICAgdGhpcy5zY3JvbGxPZmZzZXQgPSBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcDtcbiAgICB9XG5cbiAgICBkcmF3SW1hZ2UoZnJhbWUpIHtcblxuICAgICAgICBpZihmcmFtZSA+PSAwICYmIGZyYW1lIDwgdGhpcy5zZXF1ZW5jZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuY29udGV4dC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCk7XG4gICAgICAgICAgICBpZih0aGlzLnNlcXVlbmNlW2ZyYW1lXS5jb21wbGV0ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dC5kcmF3SW1hZ2UodGhpcy5zZXF1ZW5jZVtmcmFtZV0sIDAsIDAsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRoZSBjdXJyZW50IGZyYW1lIGhhcyBub3QgYmVlbiBsb2FkZWQuIFBsZWFzZSBlbnN1cmUgYWxsIGltYWdlcyBhcmUgbG9hZGVkIGJlZm9yZSB1cGRhdGluZyB0aGUgY2FudmFzLlwiKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBub3RpZnlGcmFtZUNhbGxiYWNrcyhwcmV2aW91c0ZyYW1lLCBjdXJyZW50RnJhbWUsIGZyYW1lQ2FsbGJhY2tzKSB7XG4gICAgICBmcmFtZUNhbGxiYWNrc1xuICAgICAgICAuZm9yRWFjaCgoeyBmcmFtZSwgb25FbnRlciA9ICgpID0+IHt9LCBvbkxlYXZlID0gKCkgPT4ge30gfSkgPT4ge1xuICAgICAgICAgIGlmIChjdXJyZW50RnJhbWUgPCBmcmFtZSAmJiBmcmFtZSA8PSBwcmV2aW91c0ZyYW1lKSB7XG4gICAgICAgICAgICBvbkxlYXZlLmNhbGwodGhpcyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYgKHByZXZpb3VzRnJhbWUgPCBmcmFtZSAmJiBmcmFtZSA8PSBjdXJyZW50RnJhbWUpIHtcbiAgICAgICAgICAgIG9uRW50ZXIuY2FsbCh0aGlzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHJlbmRlckZyYW1lKCkge1xuXG4gICAgICAgIHRoaXMuc3luY1Njcm9sbFBvc2l0aW9uKCk7XG5cbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyRnJhbWUoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5wcmV2aW91c0ZyYW1lID0gdGhpcy5jdXJyZW50RnJhbWU7XG4gICAgICAgIHRoaXMuY3VycmVudEZyYW1lID0gdGhpcy5nZXROZXh0RnJhbWVOdW1iZXIoKTtcblxuICAgICAgICBpZiggKHRoaXMuY3VycmVudEZyYW1lICE9IHRoaXMucHJldmlvdXNGcmFtZSkgfHwgdGhpcy5maXJzdExvYWQpIHtcbiAgICAgICAgICAgIHRoaXMuZHJhd0ltYWdlKHRoaXMuY3VycmVudEZyYW1lKTtcbiAgICAgICAgICAgIHRoaXMubm90aWZ5RnJhbWVDYWxsYmFja3ModGhpcy5wcmV2aW91c0ZyYW1lLCB0aGlzLmN1cnJlbnRGcmFtZSwgdGhpcy5mcmFtZUNhbGxiYWNrcyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmZpcnN0TG9hZCA9IGZhbHNlO1xuICAgIH1cblxufVxuXG5pZiAoIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUpIHtcbiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lID0gKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gd2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgICAgICAgICAgd2luZG93Lm1velJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCAvLyBjb21tZW50IG91dCBpZiBGRjQgaXMgc2xvdyAoaXQgY2FwcyBmcmFtZXJhdGUgYXQgfjMwZnBzOiBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD02MzAxMjcpXG4gICAgICAgICAgICB3aW5kb3cub1JlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgICAgICAgICAgd2luZG93Lm1zUmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiggLyogZnVuY3Rpb24gRnJhbWVSZXF1ZXN0Q2FsbGJhY2sgKi8gY2FsbGJhY2ssIC8qIERPTUVsZW1lbnQgRWxlbWVudCAqLyBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoY2FsbGJhY2ssIDEwMDAgLyA2MCk7XG4gICAgICAgICAgICB9O1xuICAgIH0pKCk7XG59XG5cbmlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcbiAgICBkZWZpbmUoJ0NhbnZhc1NlcXVlbmNlJywgQ2FudmFzU2VxdWVuY2UpO1xufSBlbHNlIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gQ2FudmFzU2VxdWVuY2U7XG59IGVsc2Uge1xuICAgIHdpbmRvdy5DYW52YXNTZXF1ZW5jZSA9IENhbnZhc1NlcXVlbmNlO1xufVxuIl19
