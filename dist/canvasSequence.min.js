"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),CanvasSequence=function(){function e(t,n,s,i,a,o,r){var u=!(arguments.length<=7||void 0===arguments[7])&&arguments[7],c=arguments.length<=8||void 0===arguments[8]?24:arguments[8];return _classCallCheck(this,e),"object"==typeof t?this.ctor(t):void this.ctor({canvas:t,sequencePath:n,sequenceStart:s,sequenceEnd:i,fileType:a,loadCallback:o,onDraw:r,autoPlay:u,fps:c})}return _createClass(e,[{key:"ctor",value:function(e){var t=e.canvas,n=e.sequencePath,s=e.sequenceStart,i=e.sequenceEnd,a=e.fileType,o=e.loadCallback,r=e.onDraw,u=e.autoPlay,c=void 0!==u&&u,l=e.fps,h=void 0===l?24:l;this.sequence=[],this.canvas=document.getElementById(t),null!==this.canvas?this.context=this.canvas.getContext("2d"):console.log("Please ensure the lib is loaded when DOM is loaded."),this.sequencePath=n,this.sequenceStart=s,this.sequenceEnd=i,this.sequenceLength=this.sequenceEnd-this.sequenceStart,this.fileType=a||".png",this.scrollHeight=document.body.scrollHeight,this.scrollOffset=document.body.scrollTop,this.clientHeight=window.innerHeight,this.loadCallback=o||function(){},this.onDraw="function"==typeof r?r:null,this.autoPlay=c,this.isPaused=!1,this.fps=h,this.loadSequence()}},{key:"pause",value:function(){this.isPaused=!0}},{key:"play",value:function(){if(this.isPaused){var e=+new Date;this.startTime=e-this.currentFrame/this.fps*1e3,this.isPaused=!1}}},{key:"addLeadingZeros",value:function(e){for(var t=this.sequenceEnd.toString().length,n=(e>0?e:-e)+"",s="",i=t-n.length;i>0;i--)s+="0";return s+=n,e>=0?s:"-"+s}},{key:"loadSequence",value:function(){for(var e=this,t=[],n=this.sequenceStart;n<=this.sequenceEnd;n++){var s=this.addLeadingZeros(n),i=this.sequencePath+s+this.fileType,a=new Image;a.src=i;var o=new Promise(function(e,t){a.onload=e,a.onerror=t});t.push(o),this.sequence.push(a)}Promise.all(t).then(function(){e.renderFrame(),e.loadCallback()})["catch"](function(e){console.log(e)})}},{key:"getScrollFrameNumber",value:function(){var e=this.scrollOffset/(this.scrollHeight-this.clientHeight)*100,t=Math.round(e*this.sequenceLength/100);return t}},{key:"getAutoPlayFrameNumber",value:function(){return Math.round(this.fps*this.playOffset)}},{key:"getNextFrameNumber",value:function(){return this.autoPlay?this.getAutoPlayFrameNumber():this.getScrollFrameNumber()}},{key:"syncScrollPosition",value:function(){this.scrollOffset=document.body.scrollTop}},{key:"syncAutoPlayPosition",value:function(){var e=+new Date;this.startTime||(this.startTime=e,this.isPaused=!1),this.isPaused||(this.playOffset=(e-this.startTime)/1e3%(this.sequenceLength/this.fps))}},{key:"syncPlayPosition",value:function(){return this.autoPlay?this.syncAutoPlayPosition():this.syncScrollPosition()}},{key:"drawImage",value:function(e){e>=0&&e<this.sequence.length&&(this.sequence[e].complete?this.context.drawImage(this.sequence[e],0,0,this.canvas.width,this.canvas.height):console.log("The current frame has not been loaded. Please ensure all images are loaded before updating the canvas."))}},{key:"renderFrame",value:function(){var e=this;this.syncPlayPosition(),requestAnimationFrame(function(){e.renderFrame()}),this.previousFrame=this.currentFrame,this.currentFrame=this.getNextFrameNumber(),(this.currentFrame!=this.previousFrame||this.firstLoad)&&(this.drawImage(this.currentFrame),this.onDraw&&this.onDraw.call(null,this.previousFrame,this.currentFrame)),this.firstLoad=!1}}]),e}();window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}()),"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return CanvasSequence}):"undefined"!=typeof module&&module.exports?module.exports=CanvasSequence:window.CanvasSequence=CanvasSequence;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhbnZhc1NlcXVlbmNlLmpzIl0sIm5hbWVzIjpbIl9jbGFzc0NhbGxDaGVjayIsImluc3RhbmNlIiwiQ29uc3RydWN0b3IiLCJUeXBlRXJyb3IiLCJfY3JlYXRlQ2xhc3MiLCJkZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJpIiwibGVuZ3RoIiwiZGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5Iiwia2V5IiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwicHJvdG90eXBlIiwiQ2FudmFzU2VxdWVuY2UiLCJjYW52YXNPck9wdHMiLCJzZXF1ZW5jZVBhdGgiLCJzZXF1ZW5jZVN0YXJ0Iiwic2VxdWVuY2VFbmQiLCJmaWxlVHlwZSIsImxvYWRDYWxsYmFjayIsIm9uRHJhdyIsImF1dG9QbGF5IiwiYXJndW1lbnRzIiwidW5kZWZpbmVkIiwiZnBzIiwidGhpcyIsImN0b3IiLCJjYW52YXMiLCJ2YWx1ZSIsIl9yZWYiLCJfcmVmJGF1dG9QbGF5IiwiX3JlZiRmcHMiLCJzZXF1ZW5jZSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJjb250ZXh0IiwiZ2V0Q29udGV4dCIsImNvbnNvbGUiLCJsb2ciLCJzZXF1ZW5jZUxlbmd0aCIsInNjcm9sbEhlaWdodCIsImJvZHkiLCJzY3JvbGxPZmZzZXQiLCJzY3JvbGxUb3AiLCJjbGllbnRIZWlnaHQiLCJ3aW5kb3ciLCJpbm5lckhlaWdodCIsImlzUGF1c2VkIiwibG9hZFNlcXVlbmNlIiwibm93IiwiRGF0ZSIsInN0YXJ0VGltZSIsImN1cnJlbnRGcmFtZSIsIm4iLCJ0b1N0cmluZyIsInN0ciIsInplcm9zIiwiX3RoaXMiLCJwcm9taXNlcyIsImZyYW1lTnVtYmVyIiwiYWRkTGVhZGluZ1plcm9zIiwiZmlsZW5hbWUiLCJpbWciLCJJbWFnZSIsInNyYyIsInByb21pc2UiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm9ubG9hZCIsIm9uZXJyb3IiLCJwdXNoIiwiYWxsIiwidGhlbiIsInJlbmRlckZyYW1lIiwiZSIsInNjcm9sbFBlcmNlbnRhZ2UiLCJjdXJyZW50RnJhbWVOdW1iZXIiLCJNYXRoIiwicm91bmQiLCJwbGF5T2Zmc2V0IiwiZ2V0QXV0b1BsYXlGcmFtZU51bWJlciIsImdldFNjcm9sbEZyYW1lTnVtYmVyIiwic3luY0F1dG9QbGF5UG9zaXRpb24iLCJzeW5jU2Nyb2xsUG9zaXRpb24iLCJmcmFtZSIsImNvbXBsZXRlIiwiZHJhd0ltYWdlIiwid2lkdGgiLCJoZWlnaHQiLCJfdGhpczIiLCJzeW5jUGxheVBvc2l0aW9uIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwicHJldmlvdXNGcmFtZSIsImdldE5leHRGcmFtZU51bWJlciIsImZpcnN0TG9hZCIsImNhbGwiLCJ3ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJtb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJvUmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwibXNSZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJjYWxsYmFjayIsImVsZW1lbnQiLCJzZXRUaW1lb3V0IiwiZGVmaW5lIiwiYW1kIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUEsWUFJQSxTQUFTQSxpQkFBZ0JDLEVBQVVDLEdBQWUsS0FBTUQsWUFBb0JDLElBQWdCLEtBQU0sSUFBSUMsV0FBVSxxQ0FGaEgsR0FBSUMsY0FBZSxXQUFlLFFBQVNDLEdBQWlCQyxFQUFRQyxHQUFTLElBQUssR0FBSUMsR0FBSSxFQUFHQSxFQUFJRCxFQUFNRSxPQUFRRCxJQUFLLENBQUUsR0FBSUUsR0FBYUgsRUFBTUMsRUFBSUUsR0FBV0MsV0FBYUQsRUFBV0MsYUFBYyxFQUFPRCxFQUFXRSxjQUFlLEVBQVUsU0FBV0YsS0FBWUEsRUFBV0csVUFBVyxHQUFNQyxPQUFPQyxlQUFlVCxFQUFRSSxFQUFXTSxJQUFLTixJQUFpQixNQUFPLFVBQVVSLEVBQWFlLEVBQVlDLEdBQWlKLE1BQTlIRCxJQUFZWixFQUFpQkgsRUFBWWlCLFVBQVdGLEdBQWlCQyxHQUFhYixFQUFpQkgsRUFBYWdCLEdBQXFCaEIsTUFGM2hCa0IsZUFBYyxXQUtMLFFBTFRBLEdBS1VDLEVBQWNDLEVBQWNDLEVBQWVDLEVBQWFDLEVBQVVDLEVBQWNDLEdBUXhGLEdBUmdHQyxLQUFRQyxVQUFBcEIsUUFBQSxHQUFBcUIsU0FBQUQsVUFBQSxLQUFRQSxVQUFBLEdBQUVFLEVBQUdGLFVBQUFwQixRQUFBLEdBQUFxQixTQUFBRCxVQUFBLEdBQUcsR0FBRUEsVUFBQSxFQUMxSCxPQVVBN0IsaUJBQWdCZ0MsS0FoQmxCWixHQU04QixnQkFBakJDLEdBRUFXLEtBQUtDLEtBQUtaLE9BR3JCVyxNQUFLQyxNQUNEQyxPQUFRYixFQUNSQyxhQUFBQSxFQUNBQyxjQUFBQSxFQUNBQyxZQUFBQSxFQUNBQyxTQUFBQSxFQUNBQyxhQUFBQSxFQUNBQyxPQUFBQSxFQUNBQyxTQUFBQSxFQUNBRyxJQUFBQSxJQXVOUixNQTNMQTNCLGNBaERFZ0IsSUFpREVKLElBQUssT0FDTG1CLE1BaEJBLFNBQUNDLEdBaUJHLEdBakJERixHQUFGRSxFQUFFRixPQUFRWixFQUFWYyxFQUFVZCxhQUFjQyxFQUF4QmEsRUFBd0JiLGNBQWVDLEVBQXZDWSxFQUF1Q1osWUFBYUMsRUFBcERXLEVBQW9EWCxTQUFVQyxFQUE5RFUsRUFBOERWLGFBQWNDLEVBQTVFUyxFQUE0RVQsT0F3QnJFVSxFQXhCUEQsRUFBb0ZSLFNBQUFBLEVBQVFFLFNBQUFPLEdBQVFBLEVBMEI3RkMsRUExQlBGLEVBQXNHTCxJQUFBQSxFQUFHRCxTQUFBUSxFQUFHLEdBQUVBLENBQy9HTixNQUFLTyxZQUVMUCxLQUFLRSxPQUFTTSxTQUFTQyxlQUFlUCxHQUVuQixPQUFoQkYsS0FBS0UsT0FDSkYsS0FBS1UsUUFBVVYsS0FBS0UsT0FBT1MsV0FBVyxNQUV0Q0MsUUFBUUMsSUFBSSx1REFHaEJiLEtBQUtWLGFBQWVBLEVBQ3BCVSxLQUFLVCxjQUFnQkEsRUFDckJTLEtBQUtSLFlBQWNBLEVBQ25CUSxLQUFLYyxlQUFpQmQsS0FBS1IsWUFBY1EsS0FBS1QsY0FFOUNTLEtBQUtQLFNBQVdBLEdBQVksT0FFNUJPLEtBQUtlLGFBQWVQLFNBQVNRLEtBQUtELGFBQ2xDZixLQUFLaUIsYUFBZVQsU0FBU1EsS0FBS0UsVUFDbENsQixLQUFLbUIsYUFBZUMsT0FBT0MsWUFFM0JyQixLQUFLTixhQUFlQSxHQUFnQixhQUNwQ00sS0FBS0wsT0FBMkIsa0JBQVhBLEdBQXdCQSxFQUFTLEtBQ3RESyxLQUFLSixTQUFXQSxFQUNoQkksS0FBS3NCLFVBQVcsRUFDaEJ0QixLQUFLRCxJQUFNQSxFQUVYQyxLQUFLdUIsa0JBK0JMdkMsSUFBSyxRQUNMbUIsTUE3QkMsV0FDREgsS0FBS3NCLFVBQVcsS0FnQ2hCdEMsSUFBSyxPQUNMbUIsTUE5QkEsV0FDQSxHQUFLSCxLQUFLc0IsU0FBVixDQUtBLEdBQU1FLElBQU8sR0FBSUMsS0FDakJ6QixNQUFLMEIsVUFBWUYsRUFBT3hCLEtBQUsyQixhQUFlM0IsS0FBS0QsSUFBTSxJQUN2REMsS0FBS3NCLFVBQVcsTUFpQ2hCdEMsSUFBSyxrQkFDTG1CLE1BL0JXLFNBQUN5QixHQUlaLElBQUssR0FIRG5ELEdBQVN1QixLQUFLUixZQUFZcUMsV0FBV3BELE9BQ3JDcUQsR0FBT0YsRUFBSSxFQUFJQSxHQUFLQSxHQUFLLEdBQ3pCRyxFQUFRLEdBQ0h2RCxFQUFJQyxFQUFTcUQsRUFBSXJELE9BQVFELEVBQUksRUFBR0EsSUFDckN1RCxHQUFTLEdBRWIsT0FEQUEsSUFBU0QsRUFDRkYsR0FBSyxFQUFJRyxFQUFRLElBQU1BLEtBaUM5Qi9DLElBQUssZUFDTG1CLE1BL0JRLFdBSVIsSUFBSSxHQTRCSTZCLEdBQVFoQyxLQTlCWmlDLEtBRUl6RCxFQUFJd0IsS0FBS1QsY0FBZWYsR0FBS3dCLEtBQUtSLFlBQWFoQixJQUFLLENBRXhELEdBQUkwRCxHQUFjbEMsS0FBS21DLGdCQUFnQjNELEdBQ25DNEQsRUFBV3BDLEtBQUtWLGFBQWU0QyxFQUFjbEMsS0FBS1AsU0FDbEQ0QyxFQUFNLEdBQUlDLE1BQ2RELEdBQUlFLElBQU1ILENBRVYsSUFBSUksR0FBVSxHQUFJQyxTQUFRLFNBQVNDLEVBQVNDLEdBQ3hDTixFQUFJTyxPQUFTRixFQUNiTCxFQUFJUSxRQUFVRixHQUdsQlYsR0FBU2EsS0FBS04sR0FFZHhDLEtBQUtPLFNBQVN1QyxLQUFLVCxHQUd2QkksUUFBUU0sSUFBSWQsR0FBVWUsS0FBSyxXQUN2QmhCLEVBQUtpQixjQUNMakIsRUFBS3RDLGlCQUNQLFNBQU8sU0FBQ3dELEdBQ050QyxRQUFRQyxJQUFJcUMsUUFvQ2hCbEUsSUFBSyx1QkFDTG1CLE1BakNnQixXQUNoQixHQUFJZ0QsR0FBbUJuRCxLQUFNaUIsY0FBY2pCLEtBQUtlLGFBQWFmLEtBQUttQixjQUFlLElBQzdFaUMsRUFBcUJDLEtBQUtDLE1BQU1ILEVBQWlCbkQsS0FBS2MsZUFBZSxJQUN6RSxPQUFPc0MsTUFvQ1BwRSxJQUFLLHlCQUNMbUIsTUFsQ2tCLFdBQ2xCLE1BQU9rRCxNQUFLQyxNQUFNdEQsS0FBS0QsSUFBTUMsS0FBS3VELGVBcUNsQ3ZFLElBQUsscUJBQ0xtQixNQW5DYyxXQUNkLE1BQUlILE1BQUtKLFNBQ0VJLEtBQUt3RCx5QkFHVHhELEtBQUt5RCwwQkFzQ1p6RSxJQUFLLHFCQUNMbUIsTUFwQ2MsV0FDZEgsS0FBS2lCLGFBQWVULFNBQVNRLEtBQUtFLGFBdUNsQ2xDLElBQUssdUJBQ0xtQixNQXJDZ0IsV0FDaEIsR0FBTXFCLElBQU8sR0FBSUMsS0FDWnpCLE1BQUswQixZQUNOMUIsS0FBSzBCLFVBQVlGLEVBQ2pCeEIsS0FBS3NCLFVBQVcsR0FHZnRCLEtBQUtzQixXQUNOdEIsS0FBS3VELFlBQWUvQixFQUFNeEIsS0FBSzBCLFdBQWEsS0FBUzFCLEtBQUtjLGVBQWlCZCxLQUFLRCxTQXlDcEZmLElBQUssbUJBQ0xtQixNQXRDWSxXQUVaLE1BQUlILE1BQUtKLFNBQ0VJLEtBQUswRCx1QkFHVDFELEtBQUsyRCx3QkF5Q1ozRSxJQUFLLFlBQ0xtQixNQXZDSyxTQUFDeUQsR0FFSEEsR0FBUyxHQUFLQSxFQUFRNUQsS0FBS08sU0FBUzlCLFNBRWhDdUIsS0FBS08sU0FBU3FELEdBQU9DLFNBQ3BCN0QsS0FBS1UsUUFBUW9ELFVBQVU5RCxLQUFLTyxTQUFTcUQsR0FBUSxFQUFHLEVBQUc1RCxLQUFLRSxPQUFPNkQsTUFBTy9ELEtBQUtFLE9BQU84RCxRQUVsRnBELFFBQVFDLElBQUksOEdBNENwQjdCLElBQUssY0FDTG1CLE1BdkNPLFdBd0NILEdBQUk4RCxHQUFTakUsSUF0Q2pCQSxNQUFLa0UsbUJBRUxDLHNCQUFzQixXQUNsQkYsRUFBS2hCLGdCQUdUakQsS0FBS29FLGNBQWdCcEUsS0FBSzJCLGFBQzFCM0IsS0FBSzJCLGFBQWUzQixLQUFLcUUsc0JBRXJCckUsS0FBTTJCLGNBQWdCM0IsS0FBS29FLGVBQWtCcEUsS0FBS3NFLGFBQ2xEdEUsS0FBSzhELFVBQVU5RCxLQUFLMkIsY0FDcEIzQixLQUFLTCxRQUFVSyxLQUFLTCxPQUFPNEUsS0FBSyxLQUFNdkUsS0FBS29FLGNBQWVwRSxLQUFLMkIsZUFHbkUzQixLQUFLc0UsV0FBWSxNQS9MbkJsRixJQW9NRGdDLFFBQU8rQyx3QkFDUi9DLE9BQU8rQyxzQkFBd0IsV0FDM0IsTUFBTy9DLFFBQU9vRCw2QkFDVnBELE9BQU9xRCwwQkFDUHJELE9BQU9zRCx3QkFDUHRELE9BQU91RCx5QkFDUCxTQUE4Q0MsRUFBbUNDLEdBQzdFekQsT0FBTzBELFdBQVdGLEVBQVUsSUFBTyxTQUs3QixrQkFBWEcsU0FBK0MsZ0JBQWZBLFFBQU9DLEtBQW9CRCxPQUFPQyxJQUN6RUQsT0FBTyxXQUNMLE1BQU8zRixrQkFFZ0IsbUJBQVg2RixTQUEwQkEsT0FBT0MsUUFDL0NELE9BQU9DLFFBQVU5RixlQUVqQmdDLE9BQU9oQyxlQUFpQkEiLCJmaWxlIjoiY2FudmFzU2VxdWVuY2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBDYW52YXNTZXF1ZW5jZSB7XG5cbiAgICAvKipcbiAgICAgKiBAc2VlIGN0b3JcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihjYW52YXNPck9wdHMsIHNlcXVlbmNlUGF0aCwgc2VxdWVuY2VTdGFydCwgc2VxdWVuY2VFbmQsIGZpbGVUeXBlLCBsb2FkQ2FsbGJhY2ssIG9uRHJhdywgYXV0b1BsYXkgPSBmYWxzZSwgZnBzID0gMjQpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBjYW52YXNPck9wdHMgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAvLyBmaXJzdCBwYXJhbSBpcyBhbiBvYmplY3Qgb2Ygb3B0aW9uc1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3RvcihjYW52YXNPck9wdHMpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jdG9yKHtcbiAgICAgICAgICAgIGNhbnZhczogY2FudmFzT3JPcHRzLFxuICAgICAgICAgICAgc2VxdWVuY2VQYXRoLFxuICAgICAgICAgICAgc2VxdWVuY2VTdGFydCxcbiAgICAgICAgICAgIHNlcXVlbmNlRW5kLFxuICAgICAgICAgICAgZmlsZVR5cGUsXG4gICAgICAgICAgICBsb2FkQ2FsbGJhY2ssXG4gICAgICAgICAgICBvbkRyYXcsXG4gICAgICAgICAgICBhdXRvUGxheSxcbiAgICAgICAgICAgIGZwc1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQHBhcmFtIG9wdHMuY2FudmFzSWQge1N0cmluZ30gLSBpZCBvZiB0aGUgY2FudmFzIHRhZyB5b3Ugd2FudCB0byB1c2VcbiAgICAgKiBAcGFyYW0gb3B0cy5zZXF1ZW5jZVBhdGgge1N0cmluZ30gLSB0aGUgcGF0aCB0byB5b3VyIGltYWdlIHNlcXVlbmNlIChleC4gJy4vaW1nL3NlcXVlbmNlLycpLiBJZiB5b3VyIGltYWdlcyBuYW1lcyBhcmUgcHJlZml4ZWQgKGV4LiBpbWdfMDAwLmpwZykgeW91IG11c3QgaW5jbHVkZSB0aGUgcHJlZml4IGluIHRoZSBwYXRoLlxuICAgICAqIEBwYXJhbSBvcHRzLnNlcXVlbmNlU3RhcnQge0ludH0gLSB0aGUgbnVtYmVyIG9mIHRoZSBmaXJzdCBmcmFtZSAoZXguIGlmIHlvdXIgZmlyc3QgZnJhbWUgaXMgaW1nXzAwMDU2LmpwZyB0aGVuIHNlcXVlbmNlU3RhcnQgPSA1NilcbiAgICAgKiBAcGFyYW0gb3B0cy5zZXF1ZW5jZUVuZCB7SW50fSAtIHRoZSBudW1iZXIgb2YgdGhlIGxhc3QgZnJhbWVcbiAgICAgKiBAcGFyYW0gb3B0cy5maWxlVHlwZSB7U3RyaW5nfSAtIHRoZSBmaWxlIGV4dGVuc2lvbiB5b3Ugd2FudCB0byB1c2UgKGV4LiAnanBnJylcbiAgICAgKiBAcGFyYW0gb3B0cy5sb2FkQ2FsbGJhY2sge2Z1bmN0aW9ufSAtIGEgY2FsbGJhY2sgdG8gYmUgbm90aWZpZWQgd2hlbiBhbGwgaW1hZ2VzIGFyZSBsb2FkZWQgYW5kIHJlYWR5IHRvIHVzZVxuICAgICAqIEBwYXJhbSBvcHRzLm9uRHJhdyB7ZnVuY3Rpb24ocHJldmlvdXNGcmFtZTpJbnQsIGN1cnJlbnRGcmFtZTpJbnQpYH0gLSBhIGNhbGxiYWNrIHRvIGJlIG5vdGlmaWVkIHdoZW4gdGhlIGRyYXduIGZyYW1lIGNoYW5nZXNcbiAgICAgKiBAcGFyYW0gb3B0cy5hdXRvUGxheSB7Qm9vbGVhbn0gLSBEZWZhdWx0cyB0byBgZmFsc2VgLiBhIGZsYWcgdG8gbWFrZSB0aGUgc2VxdWVuY2UgcGxheSB3aXRob3V0IGJpbmRpbmcgdG8gc2Nyb2xsIChsaWtlIGEgcmVndWxhciB2aWRlbylcbiAgICAgKiBAcGFyYW0gb3B0cy5mcHMge051bWJlcn0gLSBEZWZhdWx0cyB0byBgMjRgLiBGcmFtZXMgcGVyIHNlY29uZCB0byB1c2UgZm9yIHZpZGVvLWxpa2UgcGxheWJhY2tcbiAgICAgKi9cbiAgICBjdG9yKHsgY2FudmFzLCBzZXF1ZW5jZVBhdGgsIHNlcXVlbmNlU3RhcnQsIHNlcXVlbmNlRW5kLCBmaWxlVHlwZSwgbG9hZENhbGxiYWNrLCBvbkRyYXcsIGF1dG9QbGF5ID0gZmFsc2UsIGZwcyA9IDI0IH0pIHtcbiAgICAgICAgdGhpcy5zZXF1ZW5jZSA9IFtdO1xuXG4gICAgICAgIHRoaXMuY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY2FudmFzKTtcblxuICAgICAgICBpZih0aGlzLmNhbnZhcyAhPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5jb250ZXh0ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiUGxlYXNlIGVuc3VyZSB0aGUgbGliIGlzIGxvYWRlZCB3aGVuIERPTSBpcyBsb2FkZWQuXCIpXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNlcXVlbmNlUGF0aCA9IHNlcXVlbmNlUGF0aDtcbiAgICAgICAgdGhpcy5zZXF1ZW5jZVN0YXJ0ID0gc2VxdWVuY2VTdGFydDtcbiAgICAgICAgdGhpcy5zZXF1ZW5jZUVuZCA9IHNlcXVlbmNlRW5kO1xuICAgICAgICB0aGlzLnNlcXVlbmNlTGVuZ3RoID0gdGhpcy5zZXF1ZW5jZUVuZCAtIHRoaXMuc2VxdWVuY2VTdGFydDtcblxuICAgICAgICB0aGlzLmZpbGVUeXBlID0gZmlsZVR5cGUgfHwgJy5wbmcnO1xuXG4gICAgICAgIHRoaXMuc2Nyb2xsSGVpZ2h0ID0gZG9jdW1lbnQuYm9keS5zY3JvbGxIZWlnaHQ7XG4gICAgICAgIHRoaXMuc2Nyb2xsT2Zmc2V0ID0gZG9jdW1lbnQuYm9keS5zY3JvbGxUb3A7XG4gICAgICAgIHRoaXMuY2xpZW50SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuXG4gICAgICAgIHRoaXMubG9hZENhbGxiYWNrID0gbG9hZENhbGxiYWNrIHx8IGZ1bmN0aW9uKCkge307XG4gICAgICAgIHRoaXMub25EcmF3ID0gdHlwZW9mIG9uRHJhdyA9PT0gJ2Z1bmN0aW9uJyA/IG9uRHJhdyA6IG51bGw7XG4gICAgICAgIHRoaXMuYXV0b1BsYXkgPSBhdXRvUGxheTtcbiAgICAgICAgdGhpcy5pc1BhdXNlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmZwcyA9IGZwcztcblxuICAgICAgICB0aGlzLmxvYWRTZXF1ZW5jZSgpO1xuICAgIH1cblxuICAgIHBhdXNlKCkge1xuICAgICAgICB0aGlzLmlzUGF1c2VkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBwbGF5KCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNQYXVzZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHJlc2V0IHN0YXJ0VGltZSBzbyB0aGF0IGl0IGlzIHJlbGF0aXZlIHRvIHRoZSBjdXJyZW50IHJlcGxheSB0aW1lXG4gICAgICAgIGNvbnN0IG5vdyA9ICtuZXcgRGF0ZSgpO1xuICAgICAgICB0aGlzLnN0YXJ0VGltZSA9IG5vdyAtICh0aGlzLmN1cnJlbnRGcmFtZSAvIHRoaXMuZnBzICogMTAwMClcbiAgICAgICAgdGhpcy5pc1BhdXNlZCA9IGZhbHNlO1xuICAgIH1cblxuICAgIGFkZExlYWRpbmdaZXJvcyhuKSB7XG4gICAgICAgIHZhciBsZW5ndGggPSB0aGlzLnNlcXVlbmNlRW5kLnRvU3RyaW5nKCkubGVuZ3RoO1xuICAgICAgICB2YXIgc3RyID0gKG4gPiAwID8gbiA6IC1uKSArIFwiXCI7XG4gICAgICAgIHZhciB6ZXJvcyA9IFwiXCI7XG4gICAgICAgIGZvciAodmFyIGkgPSBsZW5ndGggLSBzdHIubGVuZ3RoOyBpID4gMDsgaS0tKVxuICAgICAgICAgICAgemVyb3MgKz0gXCIwXCI7XG4gICAgICAgIHplcm9zICs9IHN0cjtcbiAgICAgICAgcmV0dXJuIG4gPj0gMCA/IHplcm9zIDogXCItXCIgKyB6ZXJvcztcbiAgICB9XG5cbiAgICBsb2FkU2VxdWVuY2UoKSB7XG5cbiAgICAgICAgdmFyIHByb21pc2VzID0gW107XG5cbiAgICAgICAgZm9yKHZhciBpID0gdGhpcy5zZXF1ZW5jZVN0YXJ0OyBpIDw9IHRoaXMuc2VxdWVuY2VFbmQ7IGkrKykge1xuXG4gICAgICAgICAgICB2YXIgZnJhbWVOdW1iZXIgPSB0aGlzLmFkZExlYWRpbmdaZXJvcyhpKTtcbiAgICAgICAgICAgIHZhciBmaWxlbmFtZSA9IHRoaXMuc2VxdWVuY2VQYXRoICsgZnJhbWVOdW1iZXIgKyB0aGlzLmZpbGVUeXBlO1xuICAgICAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZTtcbiAgICAgICAgICAgIGltZy5zcmMgPSBmaWxlbmFtZTtcblxuICAgICAgICAgICAgdmFyIHByb21pc2UgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICBpbWcub25sb2FkID0gcmVzb2x2ZTtcbiAgICAgICAgICAgICAgICBpbWcub25lcnJvciA9IHJlamVjdDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBwcm9taXNlcy5wdXNoKHByb21pc2UpO1xuXG4gICAgICAgICAgICB0aGlzLnNlcXVlbmNlLnB1c2goaW1nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIFByb21pc2UuYWxsKHByb21pc2VzKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyRnJhbWUoKTtcbiAgICAgICAgICAgIHRoaXMubG9hZENhbGxiYWNrKCk7XG4gICAgICAgIH0pLmNhdGNoKChlKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZ2V0U2Nyb2xsRnJhbWVOdW1iZXIoKSB7XG4gICAgICAgIHZhciBzY3JvbGxQZXJjZW50YWdlID0gKHRoaXMuc2Nyb2xsT2Zmc2V0Lyh0aGlzLnNjcm9sbEhlaWdodC10aGlzLmNsaWVudEhlaWdodCkpKjEwMDtcbiAgICAgICAgdmFyIGN1cnJlbnRGcmFtZU51bWJlciA9IE1hdGgucm91bmQoc2Nyb2xsUGVyY2VudGFnZSp0aGlzLnNlcXVlbmNlTGVuZ3RoLzEwMCk7XG4gICAgICAgIHJldHVybiBjdXJyZW50RnJhbWVOdW1iZXI7XG4gICAgfVxuXG4gICAgZ2V0QXV0b1BsYXlGcmFtZU51bWJlcigpIHtcbiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQodGhpcy5mcHMgKiB0aGlzLnBsYXlPZmZzZXQpO1xuICAgIH1cblxuICAgIGdldE5leHRGcmFtZU51bWJlcigpIHtcbiAgICAgICAgaWYgKHRoaXMuYXV0b1BsYXkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEF1dG9QbGF5RnJhbWVOdW1iZXIoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLmdldFNjcm9sbEZyYW1lTnVtYmVyKCk7XG4gICAgfVxuXG4gICAgc3luY1Njcm9sbFBvc2l0aW9uKCkge1xuICAgICAgICB0aGlzLnNjcm9sbE9mZnNldCA9IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wO1xuICAgIH1cblxuICAgIHN5bmNBdXRvUGxheVBvc2l0aW9uKCkge1xuICAgICAgICBjb25zdCBub3cgPSArbmV3IERhdGUoKTtcbiAgICAgICAgaWYgKCF0aGlzLnN0YXJ0VGltZSkge1xuICAgICAgICAgICAgdGhpcy5zdGFydFRpbWUgPSBub3c7XG4gICAgICAgICAgICB0aGlzLmlzUGF1c2VkID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMuaXNQYXVzZWQpIHtcbiAgICAgICAgICAgIHRoaXMucGxheU9mZnNldCA9ICgobm93IC0gdGhpcy5zdGFydFRpbWUpIC8gMTAwMCkgJSAodGhpcy5zZXF1ZW5jZUxlbmd0aCAvIHRoaXMuZnBzKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN5bmNQbGF5UG9zaXRpb24oKSB7XG4gICAgICAgIC8vIG5vIHNjcm9sbCB0cmFja2luZyBmb3IgYXV0b3BsYXlcbiAgICAgICAgaWYgKHRoaXMuYXV0b1BsYXkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnN5bmNBdXRvUGxheVBvc2l0aW9uKCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5zeW5jU2Nyb2xsUG9zaXRpb24oKTtcbiAgICB9XG5cbiAgICBkcmF3SW1hZ2UoZnJhbWUpIHtcblxuICAgICAgICBpZihmcmFtZSA+PSAwICYmIGZyYW1lIDwgdGhpcy5zZXF1ZW5jZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIC8vIHRoaXMuY29udGV4dC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCk7XG4gICAgICAgICAgICBpZih0aGlzLnNlcXVlbmNlW2ZyYW1lXS5jb21wbGV0ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dC5kcmF3SW1hZ2UodGhpcy5zZXF1ZW5jZVtmcmFtZV0sIDAsIDAsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRoZSBjdXJyZW50IGZyYW1lIGhhcyBub3QgYmVlbiBsb2FkZWQuIFBsZWFzZSBlbnN1cmUgYWxsIGltYWdlcyBhcmUgbG9hZGVkIGJlZm9yZSB1cGRhdGluZyB0aGUgY2FudmFzLlwiKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICByZW5kZXJGcmFtZSgpIHtcblxuICAgICAgICB0aGlzLnN5bmNQbGF5UG9zaXRpb24oKTtcblxuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJGcmFtZSgpO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnByZXZpb3VzRnJhbWUgPSB0aGlzLmN1cnJlbnRGcmFtZTtcbiAgICAgICAgdGhpcy5jdXJyZW50RnJhbWUgPSB0aGlzLmdldE5leHRGcmFtZU51bWJlcigpO1xuXG4gICAgICAgIGlmICgodGhpcy5jdXJyZW50RnJhbWUgIT0gdGhpcy5wcmV2aW91c0ZyYW1lKSB8fCB0aGlzLmZpcnN0TG9hZCkge1xuICAgICAgICAgICAgdGhpcy5kcmF3SW1hZ2UodGhpcy5jdXJyZW50RnJhbWUpO1xuICAgICAgICAgICAgdGhpcy5vbkRyYXcgJiYgdGhpcy5vbkRyYXcuY2FsbChudWxsLCB0aGlzLnByZXZpb3VzRnJhbWUsIHRoaXMuY3VycmVudEZyYW1lKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZmlyc3RMb2FkID0gZmFsc2U7XG4gICAgfVxuXG59XG5cbmlmICghd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSkge1xuICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSAoZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB3aW5kb3cud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XG4gICAgICAgICAgICB3aW5kb3cubW96UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IC8vIGNvbW1lbnQgb3V0IGlmIEZGNCBpcyBzbG93IChpdCBjYXBzIGZyYW1lcmF0ZSBhdCB+MzBmcHM6IGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTYzMDEyNylcbiAgICAgICAgICAgIHdpbmRvdy5vUmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XG4gICAgICAgICAgICB3aW5kb3cubXNSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uKCAvKiBmdW5jdGlvbiBGcmFtZVJlcXVlc3RDYWxsYmFjayAqLyBjYWxsYmFjaywgLyogRE9NRWxlbWVudCBFbGVtZW50ICovIGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dChjYWxsYmFjaywgMTAwMCAvIDYwKTtcbiAgICAgICAgICAgIH07XG4gICAgfSkoKTtcbn1cblxuaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIGRlZmluZS5hbWQgPT09ICdvYmplY3QnICYmIGRlZmluZS5hbWQpIHtcbiAgICBkZWZpbmUoZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gQ2FudmFzU2VxdWVuY2U7XG4gICAgfSk7XG59IGVsc2UgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBDYW52YXNTZXF1ZW5jZTtcbn0gZWxzZSB7XG4gICAgd2luZG93LkNhbnZhc1NlcXVlbmNlID0gQ2FudmFzU2VxdWVuY2U7XG59XG4iXX0=
