"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),CanvasSequence=function(){function e(t,n,s,i,a,o,r){var u=arguments.length<=7||void 0===arguments[7]?e.PlayMode.SCROLL:arguments[7],c=arguments.length<=8||void 0===arguments[8]?24:arguments[8],h=!(arguments.length<=9||void 0===arguments[9])&&arguments[9];return _classCallCheck(this,e),"object"==typeof t?this.ctor(t):void this.ctor({canvas:t,sequencePath:n,sequenceStart:s,sequenceEnd:i,fileType:a,loadCallback:o,onDraw:r,mode:u,fps:c,playOnce:h})}return _createClass(e,[{key:"ctor",value:function(t){var n=t.canvas,s=t.sequencePath,i=t.sequenceStart,a=t.sequenceEnd,o=t.fileType,r=t.loadCallback,u=t.onDraw,c=t.mode,h=void 0===c?e.PlayMode.SCROLL:c,l=t.fps,d=void 0===l?24:l,m=t.isPaused,f=void 0!==m&&m,v=t.playOnce,y=void 0!==v&&v;this.sequence=[],this.canvas=document.getElementById(n),null!==this.canvas?this.context=this.canvas.getContext("2d"):console.log("Please ensure the lib is loaded when DOM is loaded."),this.sequencePath=s,this.sequenceStart=i,this.sequenceEnd=a,this.sequenceLength=this.sequenceEnd-this.sequenceStart,this.fileType=o||".png",this.progress=0,this.scrollHeight=document.body.scrollHeight,this.loadCallback=r||function(){},this.onDraw="function"==typeof u?u:null,this.mode=h,this.isPaused=f,this.firstLoopEnd=!1,this.fps=d,this.playOnce=y,this.loadSequence()}},{key:"pause",value:function(){this.isPaused=!0}},{key:"play",value:function(){if(this.isPaused){var e=+new Date;this.startTime=e-this.currentFrame/this.fps*1e3,this.isPaused=!1,this.firstLoopEnd=!1}}},{key:"addLeadingZeros",value:function(e){for(var t=this.sequenceEnd.toString().length,n=(e>0?e:-e)+"",s="",i=t-n.length;i>0;i--)s+="0";return s+=n,e>=0?s:"-"+s}},{key:"loadSequence",value:function(){for(var e=this,t=[],n=this.sequenceStart;n<=this.sequenceEnd;n++){var s=this.addLeadingZeros(n),i=this.sequencePath+s+this.fileType,a=new Image;a.src=i;var o=new Promise(function(e,t){a.onload=e,a.onerror=t});t.push(o),this.sequence.push(a)}Promise.all(t).then(function(){e.renderFrame(),e.loadCallback()})["catch"](function(e){console.log(e)})}},{key:"getNextFrameNumber",value:function(){return Math.min(this.sequenceLength,Math.max(0,Math.round(this.progress*this.sequenceLength)))}},{key:"syncScrollPosition",value:function(){var e=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;return e/this.scrollHeight}},{key:"syncAutoPlayPosition",value:function(){var e=+new Date;if(this.startTime||(this.startTime=e),!this.isPaused){var t=this.sequenceLength/this.fps,n=(e-this.startTime)/1e3%t;return n/t}return this.progress}},{key:"syncPlayPosition",value:function(){switch(this.mode){case e.PlayMode.AUTO:this.progress=this.syncAutoPlayPosition();break;case e.PlayMode.MANUAL:break;case e.PlayMode.SCROLL:default:this.progress=this.syncScrollPosition()}}},{key:"setProgress",value:function(t){this.progress=t,this.mode===e.PlayMode.MANUAL&&requestAnimationFrame(this.renderFrame.bind(this))}},{key:"drawImage",value:function(e){e>=0&&e<this.sequence.length&&(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.sequence[e].complete?this.context.drawImage(this.sequence[e],0,0,this.canvas.width,this.canvas.height):console.log("The current frame has not been loaded. Please ensure all images are loaded before updating the canvas."))}},{key:"renderFrame",value:function(){this.syncPlayPosition(),this.playOnce&&this.firstLoopEnd&&this.pause(),this.mode!==e.PlayMode.MANUAL&&requestAnimationFrame(this.renderFrame.bind(this)),this.previousFrame=this.currentFrame,this.currentFrame=this.getNextFrameNumber(),(this.currentFrame!=this.previousFrame||this.firstLoad)&&(this.drawImage(this.currentFrame),this.onDraw&&this.onDraw.call(null,this.previousFrame,this.currentFrame)),this.getNextFrameNumber()===this.sequenceEnd-1&&(this.firstLoopEnd=!0),this.firstLoad=!1}}]),e}();CanvasSequence.PlayMode={SCROLL:"SCROLL",AUTO:"AUTO",MANUAL:"MANUAL"},window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}()),"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return CanvasSequence}):"undefined"!=typeof module&&module.exports?module.exports=CanvasSequence:window.CanvasSequence=CanvasSequence;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhbnZhc1NlcXVlbmNlLmpzIl0sIm5hbWVzIjpbIl9jbGFzc0NhbGxDaGVjayIsImluc3RhbmNlIiwiQ29uc3RydWN0b3IiLCJUeXBlRXJyb3IiLCJfY3JlYXRlQ2xhc3MiLCJkZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJpIiwibGVuZ3RoIiwiZGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5Iiwia2V5IiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwicHJvdG90eXBlIiwiQ2FudmFzU2VxdWVuY2UiLCJjYW52YXNPck9wdHMiLCJzZXF1ZW5jZVBhdGgiLCJzZXF1ZW5jZVN0YXJ0Iiwic2VxdWVuY2VFbmQiLCJmaWxlVHlwZSIsImxvYWRDYWxsYmFjayIsIm9uRHJhdyIsIm1vZGUiLCJhcmd1bWVudHMiLCJ1bmRlZmluZWQiLCJQbGF5TW9kZSIsIlNDUk9MTCIsImZwcyIsInBsYXlPbmNlIiwidGhpcyIsImN0b3IiLCJjYW52YXMiLCJ2YWx1ZSIsIl9yZWYiLCJfcmVmJG1vZGUiLCJfcmVmJGZwcyIsIl9yZWYkaXNQYXVzZWQiLCJpc1BhdXNlZCIsIl9yZWYkcGxheU9uY2UiLCJzZXF1ZW5jZSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJjb250ZXh0IiwiZ2V0Q29udGV4dCIsImNvbnNvbGUiLCJsb2ciLCJzZXF1ZW5jZUxlbmd0aCIsInByb2dyZXNzIiwic2Nyb2xsSGVpZ2h0IiwiYm9keSIsImZpcnN0TG9vcEVuZCIsImxvYWRTZXF1ZW5jZSIsIm5vdyIsIkRhdGUiLCJzdGFydFRpbWUiLCJjdXJyZW50RnJhbWUiLCJuIiwidG9TdHJpbmciLCJzdHIiLCJ6ZXJvcyIsIl90aGlzIiwicHJvbWlzZXMiLCJmcmFtZU51bWJlciIsImFkZExlYWRpbmdaZXJvcyIsImZpbGVuYW1lIiwiaW1nIiwiSW1hZ2UiLCJzcmMiLCJwcm9taXNlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJvbmxvYWQiLCJvbmVycm9yIiwicHVzaCIsImFsbCIsInRoZW4iLCJyZW5kZXJGcmFtZSIsImUiLCJNYXRoIiwibWluIiwibWF4Iiwicm91bmQiLCJzY3JvbGxPZmZzZXQiLCJ3aW5kb3ciLCJwYWdlWU9mZnNldCIsImRvY3VtZW50RWxlbWVudCIsInNjcm9sbFRvcCIsInNlcXVlbmNlRHVyYXRpb24iLCJwbGF5T2Zmc2V0IiwiQVVUTyIsInN5bmNBdXRvUGxheVBvc2l0aW9uIiwiTUFOVUFMIiwic3luY1Njcm9sbFBvc2l0aW9uIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwiYmluZCIsImZyYW1lIiwiY2xlYXJSZWN0Iiwid2lkdGgiLCJoZWlnaHQiLCJjb21wbGV0ZSIsImRyYXdJbWFnZSIsInN5bmNQbGF5UG9zaXRpb24iLCJwYXVzZSIsInByZXZpb3VzRnJhbWUiLCJnZXROZXh0RnJhbWVOdW1iZXIiLCJmaXJzdExvYWQiLCJjYWxsIiwid2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwibW96UmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwib1JlcXVlc3RBbmltYXRpb25GcmFtZSIsIm1zUmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwiY2FsbGJhY2siLCJlbGVtZW50Iiwic2V0VGltZW91dCIsImRlZmluZSIsImFtZCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBLFlBSUEsU0FBU0EsaUJBQWdCQyxFQUFVQyxHQUFlLEtBQU1ELFlBQW9CQyxJQUFnQixLQUFNLElBQUlDLFdBQVUscUNBRmhILEdBQUlDLGNBQWUsV0FBZSxRQUFTQyxHQUFpQkMsRUFBUUMsR0FBUyxJQUFLLEdBQUlDLEdBQUksRUFBR0EsRUFBSUQsRUFBTUUsT0FBUUQsSUFBSyxDQUFFLEdBQUlFLEdBQWFILEVBQU1DLEVBQUlFLEdBQVdDLFdBQWFELEVBQVdDLGFBQWMsRUFBT0QsRUFBV0UsY0FBZSxFQUFVLFNBQVdGLEtBQVlBLEVBQVdHLFVBQVcsR0FBTUMs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MEIsY0FBZ0IxQixLQUFLMkUsZUFBa0IzRSxLQUFLNkUsYUFDbEQ3RSxLQUFLd0UsVUFBVXhFLEtBQUswQixjQUNwQjFCLEtBQUtSLFFBQVVRLEtBQUtSLE9BQU9zRixLQUFLLEtBQU05RSxLQUFLMkUsY0FBZTNFLEtBQUswQixlQUc5RDFCLEtBQUs0RSx1QkFBeUI1RSxLQUFLWCxZQUFjLElBQ2xEVyxLQUFLcUIsY0FBZSxHQUd4QnJCLEtBQUs2RSxXQUFZLE1BNU9uQjVGLElBb1BOQSxnQkFBZVcsVUFHWEMsT0FBUSxTQUdSZ0UsS0FBUSxPQUlSRSxPQUFRLFVBR1BSLE9BQU9VLHdCQUNSVixPQUFPVSxzQkFBd0IsV0FDM0IsTUFBT1YsUUFBT3dCLDZCQUNWeEIsT0FBT3lCLDBCQUNQekIsT0FBTzBCLHdCQUNQMUIsT0FBTzJCLHlCQUNQLFNBQThDQyxFQUFtQ0MsR0FDN0U3QixPQUFPOEIsV0FBV0YsRUFBVSxJQUFPLFNBSzdCLGtCQUFYRyxTQUErQyxnQkFBZkEsUUFBT0MsS0FBb0JELE9BQU9DLElBQ3pFRCxPQUFPLFdBQ0gsTUFBT3JHLGtCQUVjLG1CQUFYdUcsU0FBMEJBLE9BQU9DLFFBQy9DRCxPQUFPQyxRQUFVeEcsZUFFakJzRSxPQUFPdEUsZUFBaUJBIiwiZmlsZSI6ImNhbnZhc1NlcXVlbmNlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgQ2FudmFzU2VxdWVuY2Uge1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQHNlZSBjdG9yXHJcbiAgICAgKi9cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIGNhbnZhc09yT3B0cyxcclxuICAgICAgICBzZXF1ZW5jZVBhdGgsXHJcbiAgICAgICAgc2VxdWVuY2VTdGFydCxcclxuICAgICAgICBzZXF1ZW5jZUVuZCxcclxuICAgICAgICBmaWxlVHlwZSxcclxuICAgICAgICBsb2FkQ2FsbGJhY2ssXHJcbiAgICAgICAgb25EcmF3LFxyXG4gICAgICAgIG1vZGUgPSBDYW52YXNTZXF1ZW5jZS5QbGF5TW9kZS5TQ1JPTEwsXHJcbiAgICAgICAgZnBzID0gMjQsXHJcbiAgICAgICAgcGxheU9uY2UgPSBmYWxzZVxyXG4gICAgKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBjYW52YXNPck9wdHMgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgIC8vIGZpcnN0IHBhcmFtIGlzIGFuIG9iamVjdCBvZiBvcHRpb25zXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmN0b3IoY2FudmFzT3JPcHRzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuY3Rvcih7XHJcbiAgICAgICAgICAgIGNhbnZhczogY2FudmFzT3JPcHRzLFxyXG4gICAgICAgICAgICBzZXF1ZW5jZVBhdGgsXHJcbiAgICAgICAgICAgIHNlcXVlbmNlU3RhcnQsXHJcbiAgICAgICAgICAgIHNlcXVlbmNlRW5kLFxyXG4gICAgICAgICAgICBmaWxlVHlwZSxcclxuICAgICAgICAgICAgbG9hZENhbGxiYWNrLFxyXG4gICAgICAgICAgICBvbkRyYXcsXHJcbiAgICAgICAgICAgIG1vZGUsXHJcbiAgICAgICAgICAgIGZwcyxcclxuICAgICAgICAgICAgcGxheU9uY2VcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQHBhcmFtIG9wdHMuZmlsZVR5cGUge1N0cmluZ30gLSB0aGUgZmlsZSBleHRlbnNpb24geW91IHdhbnQgdG8gdXNlIChleC5cclxuICAgICAqICdqcGcnKVxyXG4gICAgICogQHBhcmFtIG9wdHMubG9hZENhbGxiYWNrIHtmdW5jdGlvbn0gLSBhIGNhbGxiYWNrIHRvIGJlIG5vdGlmaWVkIHdoZW4gYWxsXHJcbiAgICAgKiBpbWFnZXMgYXJlIGxvYWRlZCBhbmQgcmVhZHkgdG8gdXNlXHJcbiAgICAgKiBAcGFyYW0gb3B0cy5vbkRyYXcge2Z1bmN0aW9uKHByZXZpb3VzRnJhbWU6SW50LCBjdXJyZW50RnJhbWU6SW50KWB9IC0gYVxyXG4gICAgICogY2FsbGJhY2sgdG8gYmUgbm90aWZpZWQgd2hlbiB0aGUgZHJhd24gZnJhbWUgY2hhbmdlc1xyXG4gICAgICogQHBhcmFtIFtvcHRzLm1vZGVdIHtTdHJpbmd9IC0gRGVmYXVsdHMgdG8gYCdTQ1JPTEwnYC4gTWV0aG9kIHRvIHVzZSBmb3JcclxuICAgICAqIGNvbnRyb2xsaW5nIHBsYXliYWNrIG9mIHRoZSBzZXF1ZW5jZVxyXG4gICAgICogU2VlIGBDYW52YXNTZXF1ZW5jZS5QbGF5TW9kZWAgZm9yIGZ1bGwgbGlzdCBvZiBzdXBwb3J0ZWQgcGxheSBtb2Rlc1xyXG4gICAgICogQHBhcmFtIG9wdHMuZnBzIHtOdW1iZXJ9IC0gRGVmYXVsdHMgdG8gYDI0YC4gRnJhbWVzIHBlciBzZWNvbmQgdG8gdXNlIGZvclxyXG4gICAgICogQHBhcmFtIG9wdHMuaXNQYXVzZWQge051bWJlcn0gLSBEZWZhdWx0cyB0byBgZmFsc2VgLiBgdHJ1ZWAgdG8gaW5pdGlhbGl6ZVxyXG4gICAgICogd2l0aCBwYXVzZWQgYXV0byBwbGF5YmFjayBzdGF0ZS5cclxuICAgICAqIEBwYXJhbSBvcHRzLnBsYXlPbmNlIHtCb29sZWFufSAtIERlZmF1bHRzIHRvIGBmYWxzZWAuIGEgZmxhZyB0byBtYWtlIHRoZVxyXG4gICAgICogc2VxdWVuY2UgcGxheSBvbmx5IG9uY2VcclxuICAgICAqL1xyXG4gICAgY3Rvcih7XHJcbiAgICAgIGNhbnZhcyxcclxuICAgICAgc2VxdWVuY2VQYXRoLFxyXG4gICAgICBzZXF1ZW5jZVN0YXJ0LFxyXG4gICAgICBzZXF1ZW5jZUVuZCxcclxuICAgICAgZmlsZVR5cGUsXHJcbiAgICAgIGxvYWRDYWxsYmFjayxcclxuICAgICAgb25EcmF3LFxyXG4gICAgICBtb2RlID0gQ2FudmFzU2VxdWVuY2UuUGxheU1vZGUuU0NST0xMLFxyXG4gICAgICBmcHMgPSAyNCxcclxuICAgICAgaXNQYXVzZWQgPSBmYWxzZSxcclxuICAgICAgcGxheU9uY2UgPSBmYWxzZVxyXG4gICAgfSkge1xyXG4gICAgICAgIHRoaXMuc2VxdWVuY2UgPSBbXTtcclxuXHJcbiAgICAgICAgdGhpcy5jYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjYW52YXMpO1xyXG5cclxuICAgICAgICBpZih0aGlzLmNhbnZhcyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRleHQgPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiUGxlYXNlIGVuc3VyZSB0aGUgbGliIGlzIGxvYWRlZCB3aGVuIERPTSBpcyBsb2FkZWQuXCIpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnNlcXVlbmNlUGF0aCA9IHNlcXVlbmNlUGF0aDtcclxuICAgICAgICB0aGlzLnNlcXVlbmNlU3RhcnQgPSBzZXF1ZW5jZVN0YXJ0O1xyXG4gICAgICAgIHRoaXMuc2VxdWVuY2VFbmQgPSBzZXF1ZW5jZUVuZDtcclxuICAgICAgICB0aGlzLnNlcXVlbmNlTGVuZ3RoID0gdGhpcy5zZXF1ZW5jZUVuZCAtIHRoaXMuc2VxdWVuY2VTdGFydDtcclxuXHJcbiAgICAgICAgdGhpcy5maWxlVHlwZSA9IGZpbGVUeXBlIHx8ICcucG5nJztcclxuXHJcbiAgICAgICAgdGhpcy5wcm9ncmVzcyA9IDA7XHJcbiAgICAgICAgdGhpcy5zY3JvbGxIZWlnaHQgPSBkb2N1bWVudC5ib2R5LnNjcm9sbEhlaWdodDtcclxuICAgICAgICB0aGlzLmxvYWRDYWxsYmFjayA9IGxvYWRDYWxsYmFjayB8fCBmdW5jdGlvbigpIHt9O1xyXG4gICAgICAgIHRoaXMub25EcmF3ID0gdHlwZW9mIG9uRHJhdyA9PT0gJ2Z1bmN0aW9uJyA/IG9uRHJhdyA6IG51bGw7XHJcbiAgICAgICAgdGhpcy5tb2RlID0gbW9kZTtcclxuICAgICAgICB0aGlzLmlzUGF1c2VkID0gaXNQYXVzZWQ7XHJcbiAgICAgICAgdGhpcy5maXJzdExvb3BFbmQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmZwcyA9IGZwcztcclxuICAgICAgICB0aGlzLnBsYXlPbmNlID0gcGxheU9uY2U7XHJcblxyXG4gICAgICAgIHRoaXMubG9hZFNlcXVlbmNlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcGF1c2UoKSB7XHJcbiAgICAgICAgdGhpcy5pc1BhdXNlZCA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgcGxheSgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaXNQYXVzZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gcmVzZXQgc3RhcnRUaW1lIHNvIHRoYXQgaXQgaXMgcmVsYXRpdmUgdG8gdGhlIGN1cnJlbnQgcmVwbGF5IHRpbWVcclxuICAgICAgICBjb25zdCBub3cgPSArbmV3IERhdGUoKTtcclxuICAgICAgICB0aGlzLnN0YXJ0VGltZSA9IG5vdyAtICh0aGlzLmN1cnJlbnRGcmFtZSAvIHRoaXMuZnBzICogMTAwMClcclxuICAgICAgICB0aGlzLmlzUGF1c2VkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5maXJzdExvb3BFbmQgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBhZGRMZWFkaW5nWmVyb3Mobikge1xyXG4gICAgICAgIHZhciBsZW5ndGggPSB0aGlzLnNlcXVlbmNlRW5kLnRvU3RyaW5nKCkubGVuZ3RoO1xyXG4gICAgICAgIHZhciBzdHIgPSAobiA+IDAgPyBuIDogLW4pICsgXCJcIjtcclxuICAgICAgICB2YXIgemVyb3MgPSBcIlwiO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSBsZW5ndGggLSBzdHIubGVuZ3RoOyBpID4gMDsgaS0tKVxyXG4gICAgICAgICAgICB6ZXJvcyArPSBcIjBcIjtcclxuICAgICAgICB6ZXJvcyArPSBzdHI7XHJcbiAgICAgICAgcmV0dXJuIG4gPj0gMCA/IHplcm9zIDogXCItXCIgKyB6ZXJvcztcclxuICAgIH1cclxuXHJcbiAgICBsb2FkU2VxdWVuY2UoKSB7XHJcbiAgICAgICAgdmFyIHByb21pc2VzID0gW107XHJcblxyXG4gICAgICAgIGZvciAodmFyIGkgPSB0aGlzLnNlcXVlbmNlU3RhcnQ7IGkgPD0gdGhpcy5zZXF1ZW5jZUVuZDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBmcmFtZU51bWJlciA9IHRoaXMuYWRkTGVhZGluZ1plcm9zKGkpO1xyXG4gICAgICAgICAgICB2YXIgZmlsZW5hbWUgPSB0aGlzLnNlcXVlbmNlUGF0aCArIGZyYW1lTnVtYmVyICsgdGhpcy5maWxlVHlwZTtcclxuICAgICAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZTtcclxuICAgICAgICAgICAgaW1nLnNyYyA9IGZpbGVuYW1lO1xyXG5cclxuICAgICAgICAgICAgdmFyIHByb21pc2UgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIGltZy5vbmxvYWQgPSByZXNvbHZlO1xyXG4gICAgICAgICAgICAgICAgaW1nLm9uZXJyb3IgPSByZWplY3Q7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcHJvbWlzZXMucHVzaChwcm9taXNlKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuc2VxdWVuY2UucHVzaChpbWcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlckZyYW1lKCk7XHJcbiAgICAgICAgICAgIHRoaXMubG9hZENhbGxiYWNrKCk7XHJcbiAgICAgICAgfSkuY2F0Y2goKGUpID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0TmV4dEZyYW1lTnVtYmVyKCkge1xyXG4gICAgICByZXR1cm4gTWF0aC5taW4oXHJcbiAgICAgICAgdGhpcy5zZXF1ZW5jZUxlbmd0aCxcclxuICAgICAgICBNYXRoLm1heChcclxuICAgICAgICAgIDAsXHJcbiAgICAgICAgICBNYXRoLnJvdW5kKHRoaXMucHJvZ3Jlc3MgKiB0aGlzLnNlcXVlbmNlTGVuZ3RoKVxyXG4gICAgICAgIClcclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBzeW5jU2Nyb2xsUG9zaXRpb24oKSB7XHJcbiAgICAgICAgY29uc3Qgc2Nyb2xsT2Zmc2V0ID1cclxuICAgICAgICAgICAgd2luZG93LnBhZ2VZT2Zmc2V0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgfHwgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgfHwgMDtcclxuICAgICAgICByZXR1cm4gc2Nyb2xsT2Zmc2V0IC8gdGhpcy5zY3JvbGxIZWlnaHQ7XHJcbiAgICB9XHJcblxyXG4gICAgc3luY0F1dG9QbGF5UG9zaXRpb24oKSB7XHJcbiAgICAgICAgY29uc3Qgbm93ID0gK25ldyBEYXRlKCk7XHJcbiAgICAgICAgaWYgKCF0aGlzLnN0YXJ0VGltZSkge1xyXG4gICAgICAgICAgICB0aGlzLnN0YXJ0VGltZSA9IG5vdztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5pc1BhdXNlZCkge1xyXG4gICAgICAgICAgICBjb25zdCBzZXF1ZW5jZUR1cmF0aW9uID0gdGhpcy5zZXF1ZW5jZUxlbmd0aCAvIHRoaXMuZnBzO1xyXG4gICAgICAgICAgICAvLyBNb2R1bG8gdG8gbG9vcFxyXG4gICAgICAgICAgICBjb25zdCBwbGF5T2Zmc2V0ID0gKChub3cgLSB0aGlzLnN0YXJ0VGltZSkgLyAxMDAwKSAlIHNlcXVlbmNlRHVyYXRpb247XHJcbiAgICAgICAgICAgIHJldHVybiBwbGF5T2Zmc2V0IC8gc2VxdWVuY2VEdXJhdGlvbjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0aGlzLnByb2dyZXNzO1xyXG4gICAgfVxyXG5cclxuICAgIHN5bmNQbGF5UG9zaXRpb24oKSB7XHJcbiAgICAgICAgc3dpdGNoICh0aGlzLm1vZGUpIHtcclxuICAgICAgICAgICAgY2FzZSBDYW52YXNTZXF1ZW5jZS5QbGF5TW9kZS5BVVRPOiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnByb2dyZXNzID0gdGhpcy5zeW5jQXV0b1BsYXlQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNhc2UgQ2FudmFzU2VxdWVuY2UuUGxheU1vZGUuTUFOVUFMOlxyXG4gICAgICAgICAgICAgICAgLy8gRG8gTm90aGluZ1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlIENhbnZhc1NlcXVlbmNlLlBsYXlNb2RlLlNDUk9MTDpcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3MgPSB0aGlzLnN5bmNTY3JvbGxQb3NpdGlvbigpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZXRQcm9ncmVzcyhwcm9ncmVzcykge1xyXG4gICAgICAgIHRoaXMucHJvZ3Jlc3MgPSBwcm9ncmVzcztcclxuICAgICAgICBpZiAodGhpcy5tb2RlID09PSBDYW52YXNTZXF1ZW5jZS5QbGF5TW9kZS5NQU5VQUwpIHtcclxuICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMucmVuZGVyRnJhbWUuYmluZCh0aGlzKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGRyYXdJbWFnZShmcmFtZSkge1xyXG4gICAgICAgIGlmKGZyYW1lID49IDAgJiYgZnJhbWUgPCB0aGlzLnNlcXVlbmNlLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRleHQuY2xlYXJSZWN0KDAsIDAsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQpO1xyXG4gICAgICAgICAgICBpZih0aGlzLnNlcXVlbmNlW2ZyYW1lXS5jb21wbGV0ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250ZXh0LmRyYXdJbWFnZSh0aGlzLnNlcXVlbmNlW2ZyYW1lXSwgMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRoZSBjdXJyZW50IGZyYW1lIGhhcyBub3QgYmVlbiBsb2FkZWQuIFBsZWFzZSBlbnN1cmUgYWxsIGltYWdlcyBhcmUgbG9hZGVkIGJlZm9yZSB1cGRhdGluZyB0aGUgY2FudmFzLlwiKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlbmRlckZyYW1lKCkge1xyXG4gICAgICAgIHRoaXMuc3luY1BsYXlQb3NpdGlvbigpO1xyXG4gICAgICAgIGlmICggdGhpcy5wbGF5T25jZSAmJiB0aGlzLmZpcnN0TG9vcEVuZCApIHtcclxuICAgICAgICAgICAgdGhpcy5wYXVzZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMubW9kZSAhPT0gQ2FudmFzU2VxdWVuY2UuUGxheU1vZGUuTUFOVUFMKSB7XHJcbiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLnJlbmRlckZyYW1lLmJpbmQodGhpcykpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5wcmV2aW91c0ZyYW1lID0gdGhpcy5jdXJyZW50RnJhbWU7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50RnJhbWUgPSB0aGlzLmdldE5leHRGcmFtZU51bWJlcigpO1xyXG5cclxuICAgICAgICBpZiAoKHRoaXMuY3VycmVudEZyYW1lICE9IHRoaXMucHJldmlvdXNGcmFtZSkgfHwgdGhpcy5maXJzdExvYWQpIHtcclxuICAgICAgICAgICAgdGhpcy5kcmF3SW1hZ2UodGhpcy5jdXJyZW50RnJhbWUpO1xyXG4gICAgICAgICAgICB0aGlzLm9uRHJhdyAmJiB0aGlzLm9uRHJhdy5jYWxsKG51bGwsIHRoaXMucHJldmlvdXNGcmFtZSwgdGhpcy5jdXJyZW50RnJhbWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCB0aGlzLmdldE5leHRGcmFtZU51bWJlcigpID09PSB0aGlzLnNlcXVlbmNlRW5kIC0gMSApIHtcclxuICAgICAgICAgICAgdGhpcy5maXJzdExvb3BFbmQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5maXJzdExvYWQgPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTdXBwb3J0ZWQgcGxheWJhY2sgY29udHJvbCBvcHRpb25zXHJcbiAqL1xyXG5DYW52YXNTZXF1ZW5jZS5QbGF5TW9kZSA9IHtcclxuICAgIC8vIFNDUk9MTCAtIChEZWZhdWx0KSBwcm9ncmVzcyBpcyBib3VuZCB0byBzY3JvbGwgcG9zaXRpb24gcmVsYXRpdmUgdG8gaGVpZ2h0XHJcbiAgICAvLyBvZiBkb2N1bWVudFxyXG4gICAgU0NST0xMOiAnU0NST0xMJyxcclxuXHJcbiAgICAvLyBBVVRPIC0gbm90IGJvdW5kIHRvIHNjcm9sbCwgcGxheXMgbGlrZSBhIHJlZ3VsYXIgdmlkZW9cclxuICAgIEFVVE8gIDogJ0FVVE8nLFxyXG5cclxuICAgIC8vIE1BTlVBTCAtIHBsYXliYWNrIG1hbmFnZW1lbnQgaXMgbGVmdCB0byB0aGUgb3duZXIuIEZyYW1lIGlzIHVwZGF0YWJsZSB3aXRoXHJcbiAgICAvLyBgLnNldFByb2dyZXNzYCBtZXRob2QuXHJcbiAgICBNQU5VQUw6ICdNQU5VQUwnXHJcbn1cclxuXHJcbmlmICghd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSkge1xyXG4gICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IChmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gd2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxyXG4gICAgICAgICAgICB3aW5kb3cubW96UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IC8vIGNvbW1lbnQgb3V0IGlmIEZGNCBpcyBzbG93IChpdCBjYXBzIGZyYW1lcmF0ZSBhdCB+MzBmcHM6IGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTYzMDEyNylcclxuICAgICAgICAgICAgd2luZG93Lm9SZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcclxuICAgICAgICAgICAgd2luZG93Lm1zUmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uKCAvKiBmdW5jdGlvbiBGcmFtZVJlcXVlc3RDYWxsYmFjayAqLyBjYWxsYmFjaywgLyogRE9NRWxlbWVudCBFbGVtZW50ICovIGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGNhbGxiYWNrLCAxMDAwIC8gNjApO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgfSkoKTtcclxufVxyXG5cclxuaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIGRlZmluZS5hbWQgPT09ICdvYmplY3QnICYmIGRlZmluZS5hbWQpIHtcclxuICAgIGRlZmluZShmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gQ2FudmFzU2VxdWVuY2U7XHJcbiAgICB9KTtcclxufSBlbHNlIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykge1xyXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBDYW52YXNTZXF1ZW5jZTtcclxufSBlbHNlIHtcclxuICAgIHdpbmRvdy5DYW52YXNTZXF1ZW5jZSA9IENhbnZhc1NlcXVlbmNlO1xyXG59XHJcbiJdfQ==
