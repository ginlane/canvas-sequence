"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}(),CanvasSequence=function(){function e(n,t,i,s,a,o,r){_classCallCheck(this,e),this.sequence=[],this.canvas=document.getElementById(n),null!==this.canvas?this.context=this.canvas.getContext("2d"):console.log("Please ensure the lib is loaded when DOM is loaded."),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.sequencePath=t,this.sequenceStart=i,this.sequenceEnd=s,this.sequenceLength=this.sequenceEnd-this.sequenceStart,this.fileType=a||".png",this.scrollHeight=document.body.scrollHeight,this.scrollOffset=document.body.scrollTop,this.clientHeight=window.innerHeight,this.loadCallback=o||function(){},this.onDraw="function"==typeof r?r:null,this.loadSequence()}return _createClass(e,[{key:"addLeadingZeros",value:function(e){for(var n=this.sequenceEnd.toString().length,t=(e>0?e:-e)+"",i="",s=n-t.length;s>0;s--)i+="0";return i+=t,e>=0?i:"-"+i}},{key:"loadSequence",value:function(){for(var e=this,n=[],t=this.sequenceStart;t<=this.sequenceEnd;t++){var i=this.addLeadingZeros(t),s=this.sequencePath+i+this.fileType,a=new Image;a.src=s;var o=new Promise(function(e,n){a.onload=e,a.onerror=n});n.push(o),this.sequence.push(a)}Promise.all(n).then(function(){e.renderFrame(),e.loadCallback()})["catch"](function(e){console.log(e)})}},{key:"getNextFrameNumber",value:function(){var e=this.scrollOffset/(this.scrollHeight-this.clientHeight)*100,n=Math.round(e*this.sequenceLength/100);return n}},{key:"syncScrollPosition",value:function(){this.scrollOffset=document.body.scrollTop}},{key:"drawImage",value:function(e){e>=0&&e<this.sequence.length&&(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.sequence[e].complete?this.context.drawImage(this.sequence[e],0,0,this.canvas.width,this.canvas.height):console.log("The current frame has not been loaded. Please ensure all images are loaded before updating the canvas."))}},{key:"renderFrame",value:function(){var e=this;this.syncScrollPosition(),requestAnimationFrame(function(){e.renderFrame()}),this.previousFrame=this.currentFrame,this.currentFrame=this.getNextFrameNumber(),(this.currentFrame!=this.previousFrame||this.firstLoad)&&(this.drawImage(this.currentFrame),this.onDraw&&this.onDraw.call(null,this.previousFrame,this.currentFrame)),this.firstLoad=!1}}]),e}();window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,n){window.setTimeout(e,1e3/60)}}()),"function"==typeof define&&define.amd?define("CanvasSequence",CanvasSequence):"undefined"!=typeof module&&module.exports?module.exports=CanvasSequence:window.CanvasSequence=CanvasSequence;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNhbnZhc1NlcXVlbmNlLmpzIl0sIm5hbWVzIjpbIl9jbGFzc0NhbGxDaGVjayIsImluc3RhbmNlIiwiQ29uc3RydWN0b3IiLCJUeXBlRXJyb3IiLCJfY3JlYXRlQ2xhc3MiLCJkZWZpbmVQcm9wZXJ0aWVzIiwidGFyZ2V0IiwicHJvcHMiLCJpIiwibGVuZ3RoIiwiZGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5Iiwia2V5IiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwicHJvdG90eXBlIiwiQ2FudmFzU2VxdWVuY2UiLCJjYW52YXMiLCJzZXF1ZW5jZVBhdGgiLCJzZXF1ZW5jZVN0YXJ0Iiwic2VxdWVuY2VFbmQiLCJmaWxlVHlwZSIsImxvYWRDYWxsYmFjayIsIm9uRHJhdyIsInRoaXMiLCJzZXF1ZW5jZSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJjb250ZXh0IiwiZ2V0Q29udGV4dCIsImNvbnNvbGUiLCJsb2ciLCJ3aWR0aCIsIndpbmRvdyIsImlubmVyV2lkdGgiLCJoZWlnaHQiLCJpbm5lckhlaWdodCIsInNlcXVlbmNlTGVuZ3RoIiwic2Nyb2xsSGVpZ2h0IiwiYm9keSIsInNjcm9sbE9mZnNldCIsInNjcm9sbFRvcCIsImNsaWVudEhlaWdodCIsImxvYWRTZXF1ZW5jZSIsInZhbHVlIiwibiIsInRvU3RyaW5nIiwic3RyIiwiemVyb3MiLCJfdGhpcyIsInByb21pc2VzIiwiZnJhbWVOdW1iZXIiLCJhZGRMZWFkaW5nWmVyb3MiLCJmaWxlbmFtZSIsImltZyIsIkltYWdlIiwic3JjIiwicHJvbWlzZSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0Iiwib25sb2FkIiwib25lcnJvciIsInB1c2giLCJhbGwiLCJ0aGVuIiwicmVuZGVyRnJhbWUiLCJlIiwic2Nyb2xsUGVyY2VudGFnZSIsImN1cnJlbnRGcmFtZU51bWJlciIsIk1hdGgiLCJyb3VuZCIsImZyYW1lIiwiY2xlYXJSZWN0IiwiY29tcGxldGUiLCJkcmF3SW1hZ2UiLCJfdGhpczIiLCJzeW5jU2Nyb2xsUG9zaXRpb24iLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJwcmV2aW91c0ZyYW1lIiwiY3VycmVudEZyYW1lIiwiZ2V0TmV4dEZyYW1lTnVtYmVyIiwiZmlyc3RMb2FkIiwiY2FsbCIsIndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSIsIm1velJlcXVlc3RBbmltYXRpb25GcmFtZSIsIm9SZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJtc1JlcXVlc3RBbmltYXRpb25GcmFtZSIsImNhbGxiYWNrIiwiZWxlbWVudCIsInNldFRpbWVvdXQiLCJkZWZpbmUiLCJhbWQiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUlBLFNBQVNBLGlCQUFnQkMsRUFBVUMsR0FBZSxLQUFNRCxZQUFvQkMsSUFBZ0IsS0FBTSxJQUFJQyxXQUFVLHFDQUZoSCxHQUFJQyxjQUFlLFdBQWUsUUFBU0MsR0FBaUJDLEVBQVFDLEdBQVMsSUFBSyxHQUFJQyxHQUFJLEVBQUdBLEVBQUlELEVBQU1FLE9BQVFELElBQUssQ0FBRSxHQUFJRSxHQUFhSCxFQUFNQyxFQUFJRSxHQUFXQyxXQUFhRCxFQUFXQyxhQUFjLEVBQU9ELEVBQVdFLGNBQWUsRUFBVSxTQUFXRixLQUFZQSxFQUFXRyxVQUFXLEdBQU1DLE9BQU9DLGVBQWVULEVBQVFJLEVBQVdNLElBQUtOLElBQWlCLE1BQU8sVUFBVVIsRUFBYWUsRUFBWUMsR0FBaUosTUFBOUhELElBQVlaLEVBQWlCSCxFQUFZaUIsVUFBV0YsR0FBaUJDLEdBQWFiLEVBQWlCSCxFQUFhZ0IsR0FBcUJoQixNQUYzaEJrQixlQUFjLFdBRUwsUUFGVEEsR0FFVUMsRUFBUUMsRUFBY0MsRUFBZUMsRUFBYUMsRUFBVUMsRUFBY0MsR0FNbEYzQixnQkFBZ0I0QixLQVJsQlIsR0FJRVEsS0FBS0MsWUFFTEQsS0FBS1AsT0FBU1MsU0FBU0MsZUFBZVYsR0FFbkIs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RCxLQUFLRCxRQUFVQyxLQUFLRCxPQUFPNEQsS0FBSyxLQUFNM0QsS0FBS3VELGNBQWV2RCxLQUFLd0QsZUFHbkV4RCxLQUFLMEQsV0FBWSxNQWpIbkJsRSxJQXNIRGlCLFFBQU82Qyx3QkFDUjdDLE9BQU82QyxzQkFBd0IsV0FDM0IsTUFBTzdDLFFBQU9tRCw2QkFDVm5ELE9BQU9vRCwwQkFDUHBELE9BQU9xRCx3QkFDUHJELE9BQU9zRCx5QkFDUCxTQUE4Q0MsRUFBbUNDLEdBQzdFeEQsT0FBT3lELFdBQVdGLEVBQVUsSUFBTyxTQUs3QixrQkFBWEcsU0FBeUJBLE9BQU9DLElBQ3ZDRCxPQUFPLGlCQUFrQjNFLGdCQUNBLG1CQUFYNkUsU0FBMEJBLE9BQU9DLFFBQy9DRCxPQUFPQyxRQUFVOUUsZUFFakJpQixPQUFPakIsZUFBaUJBIiwiZmlsZSI6ImNhbnZhc1NlcXVlbmNlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgQ2FudmFzU2VxdWVuY2Uge1xuXG4gICAgY29uc3RydWN0b3IoY2FudmFzLCBzZXF1ZW5jZVBhdGgsIHNlcXVlbmNlU3RhcnQsIHNlcXVlbmNlRW5kLCBmaWxlVHlwZSwgbG9hZENhbGxiYWNrLCBvbkRyYXcpIHtcblxuICAgICAgICB0aGlzLnNlcXVlbmNlID0gW107XG5cbiAgICAgICAgdGhpcy5jYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjYW52YXMpO1xuXG4gICAgICAgIGlmKHRoaXMuY2FudmFzICE9PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRleHQgPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJQbGVhc2UgZW5zdXJlIHRoZSBsaWIgaXMgbG9hZGVkIHdoZW4gRE9NIGlzIGxvYWRlZC5cIilcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY2FudmFzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG4gICAgICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcblxuICAgICAgICB0aGlzLnNlcXVlbmNlUGF0aCA9IHNlcXVlbmNlUGF0aDtcbiAgICAgICAgdGhpcy5zZXF1ZW5jZVN0YXJ0ID0gc2VxdWVuY2VTdGFydDtcbiAgICAgICAgdGhpcy5zZXF1ZW5jZUVuZCA9IHNlcXVlbmNlRW5kO1xuICAgICAgICB0aGlzLnNlcXVlbmNlTGVuZ3RoID0gdGhpcy5zZXF1ZW5jZUVuZCAtIHRoaXMuc2VxdWVuY2VTdGFydDtcblxuICAgICAgICB0aGlzLmZpbGVUeXBlID0gZmlsZVR5cGUgfHwgJy5wbmcnO1xuXG4gICAgICAgIHRoaXMuc2Nyb2xsSGVpZ2h0ID0gZG9jdW1lbnQuYm9keS5zY3JvbGxIZWlnaHQ7XG4gICAgICAgIHRoaXMuc2Nyb2xsT2Zmc2V0ID0gZG9jdW1lbnQuYm9keS5zY3JvbGxUb3A7XG4gICAgICAgIHRoaXMuY2xpZW50SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuXG4gICAgICAgIHRoaXMubG9hZENhbGxiYWNrID0gbG9hZENhbGxiYWNrIHx8IGZ1bmN0aW9uKCkge307XG5cbiAgICAgICAgdGhpcy5vbkRyYXcgPSB0eXBlb2Ygb25EcmF3ID09PSAnZnVuY3Rpb24nID8gb25EcmF3IDogbnVsbDtcblxuICAgICAgICB0aGlzLmxvYWRTZXF1ZW5jZSgpO1xuICAgIH1cblxuICAgIGFkZExlYWRpbmdaZXJvcyhuKSB7XG4gICAgICAgIHZhciBsZW5ndGggPSB0aGlzLnNlcXVlbmNlRW5kLnRvU3RyaW5nKCkubGVuZ3RoO1xuICAgICAgICB2YXIgc3RyID0gKG4gPiAwID8gbiA6IC1uKSArIFwiXCI7XG4gICAgICAgIHZhciB6ZXJvcyA9IFwiXCI7XG4gICAgICAgIGZvciAodmFyIGkgPSBsZW5ndGggLSBzdHIubGVuZ3RoOyBpID4gMDsgaS0tKVxuICAgICAgICAgICAgemVyb3MgKz0gXCIwXCI7XG4gICAgICAgIHplcm9zICs9IHN0cjtcbiAgICAgICAgcmV0dXJuIG4gPj0gMCA/IHplcm9zIDogXCItXCIgKyB6ZXJvcztcbiAgICB9XG5cbiAgICBsb2FkU2VxdWVuY2UoKSB7XG5cbiAgICAgICAgdmFyIHByb21pc2VzID0gW107XG5cbiAgICAgICAgZm9yKHZhciBpID0gdGhpcy5zZXF1ZW5jZVN0YXJ0OyBpIDw9IHRoaXMuc2VxdWVuY2VFbmQ7IGkrKykge1xuXG4gICAgICAgICAgICB2YXIgZnJhbWVOdW1iZXIgPSB0aGlzLmFkZExlYWRpbmdaZXJvcyhpKTtcbiAgICAgICAgICAgIHZhciBmaWxlbmFtZSA9IHRoaXMuc2VxdWVuY2VQYXRoICsgZnJhbWVOdW1iZXIgKyB0aGlzLmZpbGVUeXBlO1xuICAgICAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZTtcbiAgICAgICAgICAgIGltZy5zcmMgPSBmaWxlbmFtZTtcblxuICAgICAgICAgICAgdmFyIHByb21pc2UgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICBpbWcub25sb2FkID0gcmVzb2x2ZTtcbiAgICAgICAgICAgICAgICBpbWcub25lcnJvciA9IHJlamVjdDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBwcm9taXNlcy5wdXNoKHByb21pc2UpO1xuXG4gICAgICAgICAgICB0aGlzLnNlcXVlbmNlLnB1c2goaW1nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIFByb21pc2UuYWxsKHByb21pc2VzKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyRnJhbWUoKTtcbiAgICAgICAgICAgIHRoaXMubG9hZENhbGxiYWNrKCk7XG4gICAgICAgIH0pLmNhdGNoKChlKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZ2V0TmV4dEZyYW1lTnVtYmVyKCkge1xuICAgICAgICB2YXIgc2Nyb2xsUGVyY2VudGFnZSA9ICh0aGlzLnNjcm9sbE9mZnNldC8odGhpcy5zY3JvbGxIZWlnaHQtdGhpcy5jbGllbnRIZWlnaHQpKSoxMDA7XG4gICAgICAgIHZhciBjdXJyZW50RnJhbWVOdW1iZXIgPSBNYXRoLnJvdW5kKHNjcm9sbFBlcmNlbnRhZ2UqdGhpcy5zZXF1ZW5jZUxlbmd0aC8xMDApO1xuICAgICAgICByZXR1cm4gY3VycmVudEZyYW1lTnVtYmVyO1xuICAgIH1cblxuICAgIHN5bmNTY3JvbGxQb3NpdGlvbigpIHtcbiAgICAgICAgdGhpcy5zY3JvbGxPZmZzZXQgPSBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcDtcbiAgICB9XG5cbiAgICBkcmF3SW1hZ2UoZnJhbWUpIHtcblxuICAgICAgICBpZihmcmFtZSA+PSAwICYmIGZyYW1lIDwgdGhpcy5zZXF1ZW5jZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuY29udGV4dC5jbGVhclJlY3QoMCwgMCwgdGhpcy5jYW52YXMud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodCk7XG4gICAgICAgICAgICBpZih0aGlzLnNlcXVlbmNlW2ZyYW1lXS5jb21wbGV0ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGV4dC5kcmF3SW1hZ2UodGhpcy5zZXF1ZW5jZVtmcmFtZV0sIDAsIDAsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRoZSBjdXJyZW50IGZyYW1lIGhhcyBub3QgYmVlbiBsb2FkZWQuIFBsZWFzZSBlbnN1cmUgYWxsIGltYWdlcyBhcmUgbG9hZGVkIGJlZm9yZSB1cGRhdGluZyB0aGUgY2FudmFzLlwiKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICByZW5kZXJGcmFtZSgpIHtcblxuICAgICAgICB0aGlzLnN5bmNTY3JvbGxQb3NpdGlvbigpO1xuXG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlckZyYW1lKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMucHJldmlvdXNGcmFtZSA9IHRoaXMuY3VycmVudEZyYW1lO1xuICAgICAgICB0aGlzLmN1cnJlbnRGcmFtZSA9IHRoaXMuZ2V0TmV4dEZyYW1lTnVtYmVyKCk7XG5cbiAgICAgICAgaWYoICh0aGlzLmN1cnJlbnRGcmFtZSAhPSB0aGlzLnByZXZpb3VzRnJhbWUpIHx8IHRoaXMuZmlyc3RMb2FkKSB7XG4gICAgICAgICAgICB0aGlzLmRyYXdJbWFnZSh0aGlzLmN1cnJlbnRGcmFtZSk7XG4gICAgICAgICAgICB0aGlzLm9uRHJhdyAmJiB0aGlzLm9uRHJhdy5jYWxsKG51bGwsIHRoaXMucHJldmlvdXNGcmFtZSwgdGhpcy5jdXJyZW50RnJhbWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5maXJzdExvYWQgPSBmYWxzZTtcbiAgICB9XG5cbn1cblxuaWYgKCF3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKSB7XG4gICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IChmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHdpbmRvdy53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcbiAgICAgICAgICAgIHdpbmRvdy5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgLy8gY29tbWVudCBvdXQgaWYgRkY0IGlzIHNsb3cgKGl0IGNhcHMgZnJhbWVyYXRlIGF0IH4zMGZwczogaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9NjMwMTI3KVxuICAgICAgICAgICAgd2luZG93Lm9SZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcbiAgICAgICAgICAgIHdpbmRvdy5tc1JlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24oIC8qIGZ1bmN0aW9uIEZyYW1lUmVxdWVzdENhbGxiYWNrICovIGNhbGxiYWNrLCAvKiBET01FbGVtZW50IEVsZW1lbnQgKi8gZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGNhbGxiYWNrLCAxMDAwIC8gNjApO1xuICAgICAgICAgICAgfTtcbiAgICB9KSgpO1xufVxuXG5pZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgZGVmaW5lKCdDYW52YXNTZXF1ZW5jZScsIENhbnZhc1NlcXVlbmNlKTtcbn0gZWxzZSBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IENhbnZhc1NlcXVlbmNlO1xufSBlbHNlIHtcbiAgICB3aW5kb3cuQ2FudmFzU2VxdWVuY2UgPSBDYW52YXNTZXF1ZW5jZTtcbn1cbiJdfQ==
